$NetBSD: patch-aa,v 1.3 2005/01/23 04:36:27 jlam Exp $

--- setup.sh.orig	2004-11-12 23:26:56.000000000 -0500
+++ setup.sh
@@ -425,6 +425,7 @@ else
 	fi
 
 	# Ask whether to run at boot time
+	atboot=0
 	if [ "$atboot" = "" ]; then
 		initsupp=`grep "^os_support=" "$srcdir/init/module.info" | sed -e 's/os_support=//g' | grep $os_type`
 		atboot=0
@@ -550,6 +551,7 @@ EOF
 	fi
 fi
 
+noperlpath=yes
 if [ "$noperlpath" = "" ]; then
 	echo "Inserting path to perl into scripts.."
 	(find "$wadir" -name '*.cgi' -print ; find "$wadir" -name '*.pl' -print) | $perl "$wadir/perlpath.pl" $perl -
@@ -641,6 +643,13 @@ if [ "$?" != "0" ]; then
 	echo passwd_mode=0 >> $config_dir/miniserv.conf
 fi
 
+# Default to having delays on successive incorrect passwords for the same
+# username.
+grep passdelay= $config_dir/miniserv.conf >/dev/null
+if [ "$?" != "0" ]; then
+	echo passdelay=1 >> $config_dir/miniserv.conf
+fi
+
 # If Perl crypt supports MD5, then make it the default
 if [ "$md5pass" = "1" ]; then
 	echo md5pass=1 >> $config_dir/config
@@ -681,8 +690,6 @@ if [ "\$answer" = "y" ]; then
 	$config_dir/stop
 	echo "Running uninstall scripts .."
 	(cd "$wadir" ; WEBMIN_CONFIG=$config_dir WEBMIN_VAR=$var_dir LANG= "$wadir/run-uninstalls.pl")
-	echo "Deleting $wadir .."
-	rm -rf "$wadir"
 	echo "Deleting $config_dir .."
 	rm -rf "$config_dir"
 	echo "Done!"
