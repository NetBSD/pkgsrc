$NetBSD: patch-ab,v 1.6 2003/09/20 16:39:38 fredb Exp $

--- Makefile.orig	Sun Feb 25 06:33:49 2001
+++ Makefile
@@ -4,8 +4,8 @@
 #
 # this is the C compiler to use (on SunOS, the standard "cc" does not
 # grok my code, so please use gcc there. On ISC 4.0, use "icc".).
-CC=gcc
-#CC=cc
+#CC=gcc
+CC=cc
 #
 #### C Compiler Flags ####
 #
@@ -107,7 +107,7 @@
 # prompt first. Don't forget to activate the /AutoPPP/ line in login.config!
 #
 #CFLAGS=-Wall -O2 -pipe -DSECUREWARE -DUSE_POLL
-CFLAGS=-O2 -Wall -pipe
+CFLAGS+=-DAUTO_PPP -DPREFIX=\"${PREFIX}\"
 #CFLAGS=-O -DSVR4
 #CFLAGS=-O -DSVR4 -DSVR42
 #CFLAGS=-O -DUSE_POLL
@@ -149,7 +149,7 @@
 # For Linux, add "-lutil" if the linker complains about "updwtmp".
 #
 LDFLAGS=
-LIBS=
+LIBS=-lutil
 #LIBS=-lprot -lsocket				# SCO Unix
 #LIBS=-lsocket
 #LIBS=-lbsd					# OSF/1
@@ -169,15 +169,15 @@
 #
 # if your systems doesn't have one, use the shell script that I provide
 # in "inst.sh" (taken from X11R5). Needed on IRIX5.2
-INSTALL=install -c -o bin -g bin
-#INSTALL=install -c -o root -g wheel		# NeXT/BSD
+#INSTALL=install -c -o bin -g bin
+INSTALL=install -c -o root -g wheel		# NeXT/BSD
 #INSTALL=/usr/ucb/install -c -o bin -g bin	# AIX, Solaris 2.x
 #INSTALL=installbsd -c -o bin -g bin		# OSF/1, AIX 4.1, 4.2
 #INSTALL=/usr/bin/X11/bsdinst -c -o bin 	# IRIX
 #
 # prefix, where most (all?) of the stuff lives, usually /usr/local or /usr
 #
-prefix=/usr/local
+prefix=${PREFIX}
 #
 # prefix for all the spool directories (usually /usr/spool or /var/spool)
 #
@@ -185,20 +185,20 @@
 #
 # where the mgetty + sendfax binaries live (used for "make install")
 #
-SBINDIR=$(prefix)/sbin
+SBINDIR=${PREFIX}/sbin
 #
 # where the user executable binaries live
 #
-BINDIR=$(prefix)/bin
+BINDIR=${PREFIX}/bin
 #
 # where the font+coverpage files go
 #
-LIBDIR=$(prefix)/lib/mgetty+sendfax
+LIBDIR=${PREFIX}/lib/mgetty+sendfax
 #
 # where the configuration files (*.config, aliases, fax.allow/deny) go to
 #
-CONFDIR=$(prefix)/etc/mgetty+sendfax
-#CONFDIR=/etc/default/
+CONFDIR=${MGETTY_CONFDIR}
+CONF_EXAMPLES_DIR=${PREFIX}/share/examples/mgetty+sendfax
 #
 #
 # where mgetty PID files (mgetty.pid) go to
@@ -224,20 +224,20 @@ FAX_OUT_USER=fax
 #
 #
 # Where section 1 manual pages should be placed
-MAN1DIR=$(prefix)/man/man1
+MAN1DIR=${PREFIX}/man/man1
 #
 # Where section 4 manual pages (mgettydefs.4) should be placed
-MAN4DIR=$(prefix)/man/man4
+MAN4DIR=${PREFIX}/man/man4
 #
 # Section 5 man pages (faxqueue.5)
-MAN5DIR=$(prefix)/man/man5
+MAN5DIR=${PREFIX}/man/man5
 #
 # Section 8 man pages (sendfax.8)
-MAN8DIR=$(prefix)/man/man8
+MAN8DIR=${PREFIX}/man/man8
 #
 # Where the GNU Info-Files are located
 #
-INFODIR=$(prefix)/info
+INFODIR=${PREFIX}/info
 #
 #
 # A shell that understands bourne-shell syntax
@@ -254,7 +254,7 @@
 # If you have Perl with TK extentions, define it here. This may be the
 # same as PERL=... above, or different, if you have TkPerl statically
 # linked.
-TKPERL=/usr/bin/tkperl
+#TKPERL=/usr/bin/tkperl
 #
 #
 # An echo program that understands escapes like "\n" for newline or
@@ -266,9 +266,9 @@
 # please use the "mg.echo" program provided in the compat/ subdirectory.
 # Set ECHO="mg.echo" and INSTALL_MECHO to mg.echo
 #
-ECHO="echo"
+ECHO="mg.echo"
 #
-# INSTALL_MECHO=mg.echo
+INSTALL_MECHO=mg.echo
 
 #
 # for mgetty, that's it. If you want to use the voice
@@ -276,7 +276,7 @@
 
 # To maintain security, I recommend creating a new group for
 # users who are allowed to manipulate the recorded voice messages.
-PHONE_GROUP=phone
+PHONE_GROUP=uucp
 PHONE_PERMS=770
 
 # Add -DNO_STRSTR to CFLAGS if you don't have strstr().
@@ -308,7 +308,7 @@
 
 all:	bin-all doc-all
 
-bin-all: mgetty sendfax newslock subdirs call-back 
+bin-all: mgetty sendfax newslock subdirs call-back vgetty
 
 # a few C files need extra compiler arguments
 
@@ -559,8 +559,8 @@
 # internal: use this to create a "clean" mgetty+sendfax tree
 bindist: all doc-all sedscript
 	-rm -rf bindist
-	./mkidirs bindist$(prefix) bindist$(spool)
-	bd=`pwd`/bindist; PATH=`pwd`:"$$PATH" $(MAKE) prefix=$$bd$(prefix) \
+	./mkidirs bindist${PREFIX}/ bindist$(spool)
+	bd=`pwd`/bindist; PATH=`pwd`:"$$PATH" $(MAKE) prefix=$$bd${PREFIX}/ \
 		BINDIR=$$bd$(BINDIR) SBINDIR=$$bd$(SBINDIR) \
 		LIBDIR=$$bd$(LIBDIR) CONFDIR=$$bd$(CONFDIR) \
 		spool=$$bd$(spool) FAX_SPOOL=$$bd$(FAX_SPOOL) \
@@ -572,7 +572,7 @@
 	cd bindist; gtar cvvfz mgetty$(MR).$(SR)-bin.tgz *
 
 
-install: install.bin install.doc
+install: install.bin install.doc install-vgetty
 
 install.bin: mgetty sendfax newslock \
 		login.config mgetty.config sendfax.config 
@@ -580,7 +580,7 @@
 # binaries
 #
 	-test -d $(BINDIR)  || ( ./mkidirs $(BINDIR)  ; chmod 755 $(BINDIR)  )
-	$(INSTALL) -m 755 newslock $(BINDIR)
+	$(INSTALL) -s -m 755 newslock $(BINDIR)
 
 	-test -d $(SBINDIR) || ( ./mkidirs $(SBINDIR) ; chmod 755 $(SBINDIR) )
 	-mv -f $(SBINDIR)/mgetty $(SBINDIR)/mgetty.old
@@ -592,18 +592,13 @@
 #
 	test -d $(LIBDIR)  || \
 		( ./mkidirs $(LIBDIR) ; chmod 755 $(LIBDIR) )
-	test -d $(CONFDIR) || \
-		( ./mkidirs $(CONFDIR); chmod 755 $(CONFDIR))
-	test -f $(CONFDIR)/login.config || \
-		$(INSTALL) -o root -m 600 login.config $(CONFDIR)/
-	test -f $(CONFDIR)/mgetty.config || \
-		$(INSTALL) -o root -m 600 mgetty.config $(CONFDIR)/
-	test -f $(CONFDIR)/sendfax.config || \
-		$(INSTALL) -o root -m 644 sendfax.config $(CONFDIR)/
-	test -f $(CONFDIR)/dialin.config || \
-		$(INSTALL) -o root -m 600 dialin.config $(CONFDIR)/
-	test -f $(CONFDIR)/faxrunq.config || \
-		$(INSTALL) -o root -m 644 faxrunq.config $(CONFDIR)/
+	test -d $(CONF_EXAMPLES_DIR) || \
+		( ./mkidirs $(CONF_EXAMPLES_DIR); chmod 755 $(CONF_EXAMPLES_DIR))
+	$(INSTALL) -o root -m 600 login.config $(CONF_EXAMPLES_DIR)/
+	$(INSTALL) -o root -m 600 mgetty.config $(CONF_EXAMPLES_DIR)/
+	$(INSTALL) -o root -m 644 sendfax.config $(CONF_EXAMPLES_DIR)/
+	$(INSTALL) -o root -m 600 dialin.config $(CONF_EXAMPLES_DIR)/
+	$(INSTALL) -o root -m 644 faxrunq.config $(CONF_EXAMPLES_DIR)/
 #
 # test for outdated stuff
 #
