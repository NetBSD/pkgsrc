$NetBSD: patch-ae,v 1.5 2004/04/20 18:02:16 ben Exp $

--- configure.in.orig	Sat Feb 28 11:19:39 2004
+++ configure.in
@@ -556,8 +556,8 @@ if [[ "$use_portaudio" = "v19" ]] ; then
 
 	AC_CONFIG_SUBDIRS([[lib-src/portaudio-v19]])
 
-else
-
+fi
+if [[ "$use_portaudio" = "v18" ]] ; then
 	CXXFLAGS="-I../lib-src/portaudio/pa_common $CXXFLAGS"
 
 	case "${host_os}" in
@@ -625,6 +625,81 @@ else
 
 		BUILDLIBS="$BUILDLIBS portaudio/pa_unix_oss/portaudio.a"
 		EXTRAOBJS="$EXTRAOBJS ../lib-src/portaudio/pa_unix_oss/portaudio.a"
+
+	   if [[ "$use_portmixer" = "yes" ]] ; then
+			BUILDLIBS="$BUILDLIBS portmixer/px_unix_oss/portmixer.a"
+			EXTRAOBJS="$EXTRAOBJS ../lib-src/portmixer/px_unix_oss/portmixer.a"		
+	   fi
+
+		if [[ "$use_ladspa" = "default" ]] ; then
+			use_ladspa="yes";
+		fi
+
+		AFTERBUILD=""
+
+	esac
+fi
+if [[ "$use_portaudio" = "system" ]] ; then
+
+	LIBS="$LIBS -lportaudio"
+
+	case "${host_os}" in
+	  darwin* | rhapsody*)
+		dnl Mac OS X configuration
+
+		CONFIGHEADER="configunix.h"
+
+		dnl CoreAudio
+
+		CXXFLAGS="-I../mac $CXXFLAGS"
+
+	   if [[ "$use_portmixer" = "yes" ]] ; then
+			BUILDLIBS="$BUILDLIBS portmixer/px_mac_core/portmixer.a"
+			EXTRAOBJS="$EXTRAOBJS ../lib-src/portmixer/px_mac_core/portmixer.a"		
+	   fi
+
+		LIBS="-framework AudioUnit -framework AudioToolbox $LIBS"
+		LIBS="-framework CoreAudio $LIBS -lz"
+
+		EXTRATARGETS="../Audacity.app"
+
+		if [[ "$use_ladspa" = "default" ]] ; then
+			use_ladspa="yes";
+		fi
+
+		dnl VST
+		
+		OPTOBJS="$OPTOBJS \$(OBJDIR)/effects/VST/LoadVSTMac.o"
+		OPTOBJS="$OPTOBJS \$(OBJDIR)/effects/VST/VSTEffect.o"
+
+	;;
+
+	cygwin*)
+ 	dnl Windows/CygWin configuration
+ 	
+ 	LIBS="$LIBS -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdlg32 -ladvapi32 -lshell32 -lole32 -loleaut32 -luuid -lodbc32 -lodbccp32 -lwsock32 -lwinmm"
+	LIBS="$LIBS -Wl,--subsystem,windows"
+ 	CONFIGHEADER="configwin.h"
+ 
+    if [[ "$use_portmixer" = "yes" ]] ; then
+ 		BUILDLIBS="$BUILDLIBS portmixer/px_win_wmme/portmixer.a"
+ 		EXTRAOBJS="$EXTRAOBJS ../lib-src/portmixer/px_win_wmme/portmixer.a Audacity.coff"
+    fi
+ 
+ 	if [[ "$use_ladspa" = "default" ]] ; then
+ 		use_ladspa="yes";
+ 	fi
+ 
+ 	AC_DEFINE(__CYGWIN__,1,[We're using cygwin])
+ 	AC_DEFINE(_FILE_OFFSET_BITS,32,[Placeholder for large file support])
+ 
+ 	AFTERBUILD=""
+	;;
+
+	  *)
+		dnl Unix OSS configuration
+
+		CONFIGHEADER="configunix.h"
 
 	   if [[ "$use_portmixer" = "yes" ]] ; then
 			BUILDLIBS="$BUILDLIBS portmixer/px_unix_oss/portmixer.a"
