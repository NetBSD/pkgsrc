$NetBSD: patch-aa,v 1.6 2001/12/03 15:37:14 skrll Exp $

--- configure.orig	Sat Nov 10 21:15:55 2001
+++ configure	Mon Nov 26 13:28:26 2001
@@ -10331,6 +10331,41 @@
   echo "$as_me:10331: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
   eval "ac_cv_lib_vm='-lXxf86dga -lXxf86vm'"
+
+	lib=Xxf86dga
+	shared_lib_found=no
+	for i in ${LDFLAGS}; do
+		case "$i" in
+		-L*)
+			dir=`echo $i | sed "s,^-L,,"`
+			if [ -e $dir/lib${lib}.so ] ||
+			   [ "`echo $dir/lib${lib}.so.*`" != "$dir/lib${lib}.so.*" ]; then
+				shared_lib_found=yes
+				break;
+			fi
+		esac
+	done
+	if [ "$shared_lib_found" = "no" ]; then
+		eval "ac_cv_lib_vm=no"
+	fi
+
+	lib=Xxf86vm
+	shared_lib_found=no
+	for i in ${LDFLAGS}; do
+		case "$i" in
+		-L*)
+			dir=`echo $i | sed "s,^-L,,"`
+			if [ -e $dir/lib${lib}.so ] ||
+			   [ "`echo $dir/lib${lib}.so.*`" != "$dir/lib${lib}.so.*" ]; then
+				shared_lib_found=yes
+				break;
+			fi
+		esac
+	done
+	if [ "$shared_lib_found" = "no" ]; then
+		eval "ac_cv_lib_vm=no"
+	fi
+
 else
   echo "$as_me: failed program was:" >&5
 cat conftest.$ac_ext >&5
@@ -10894,7 +10929,7 @@
       au_enable_sun=yes
       ;;
     *-*-netbsd*)
-      au_enable_sun=yes
+      au_enable_oss=yes
       ;;
     *)
       { echo "$as_me:10900: WARNING: No --enable-audio=default audio for $target" >&5
@@ -10912,7 +10947,7 @@
 echo "${ECHO_T}yes - <sys/soundcard.h>" >&6
   else
     case "$target" in
-      *linux*|*freebsd*|*bsdi*)
+      *linux*|*freebsd*|*bsdi*|*netbsd*)
 		echo "$as_me:10916: result: yes" >&5
 echo "${ECHO_T}yes" >&6
 	;;
@@ -14739,6 +14774,7 @@
 case "$host" in
   *-*-linux*) kscd_compile=yes;;
   *-*-*bsdi*) kscd_compile=yes;;
+  *-*-*netbsd*) kscd_compile=yes;;
   *-*-*bsd*) kscd_compile=no;;
   *) kscd_compile=yes;;
 esac
@@ -14875,7 +14911,7 @@
 fi
 done
 
-for ac_header in sys/soundcard.h machine/soundcard.h linux/soundcard.h
+for ac_header in soundcard.h sys/soundcard.h machine/soundcard.h linux/soundcard.h
 do
 as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
 echo "$as_me:14881: checking for $ac_header" >&5
@@ -15215,7 +15251,22 @@
   echo "$as_me:15215: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
 
+       lib=Xxf86dga
+       shared_lib_found=no
+       for i in ${LDFLAGS}; do
+               case "$i" in
+               -L*)
+                       dir=`echo $i | sed "s,^-L,,"`
+                       if [ -e $dir/lib${lib}.so ] ||
+                          [ "`echo $dir/lib${lib}.so.*`" != "$dir/lib${lib}.so.*" ]; then
+                               shared_lib_found=yes
+                               break;
+                       fi
+               esac
+       done
+       if [ "$shared_lib_found" = "yes" ]; then
                 x11_dga2=yes
+       fi
 
 else
   echo "$as_me: failed program was:" >&5
@@ -15264,7 +15315,22 @@
   echo "$as_me:15264: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
 
+       lib=Xv
+       shared_lib_found=no
+       for i in ${LDFLAGS}; do
+               case "$i" in
+               -L*)
+                       dir=`echo $i | sed "s,^-L,,"`
+                       if [ -e $dir/lib${lib}.so ] ||
+                          [ "`echo $dir/lib${lib}.so.*`" != "$dir/lib${lib}.so.*" ]; then
+                               shared_lib_found=yes
+                               break;
+                       fi
+               esac
+       done
+       if [ "$shared_lib_found" = "yes" ]; then
                 x11_xv=yes
+       fi
 
 else
   echo "$as_me: failed program was:" >&5
@@ -15313,7 +15379,22 @@
   echo "$as_me:15313: \$? = $ac_status" >&5
   (exit $ac_status); }; }; then
 
+       lib=Xxf86vm
+       shared_lib_found=no
+       for i in ${LDFLAGS}; do
+               case "$i" in
+               -L*)
+                       dir=`echo $i | sed "s,^-L,,"`
+                       if [ -e $dir/lib${lib}.so ] ||
+                          [ "`echo $dir/lib${lib}.so.*`" != "$dir/lib${lib}.so.*" ]; then
+                               shared_lib_found=yes
+                               break;
+                       fi
+               esac
+       done
+       if [ "$shared_lib_found" = "yes" ]; then
                 x11_xvidmode=yes
+       fi
 
 else
   echo "$as_me: failed program was:" >&5
@@ -15604,6 +15685,9 @@
 kde_mpeglib_compiles=no
 
 case "$OS_TYPE" in
+  NetBSD)
+    kde_mpeglib_compiles=yes
+    ;;
   Linux)
     kde_mpeglib_compiles=yes
     ;;
@@ -15870,6 +15954,7 @@
     echo "$as_me:15870: result: NetBSD :Unknown hardware. You will have problems!!" >&5
 echo "${ECHO_T}NetBSD :Unknown hardware. You will have problems!!" >&6
     OS_TYPE="BSD"
+    LIBPTHREAD="-lpthread"
 
 cat >>confdefs.h <<\EOF
 #define OS_BSD 1
