$NetBSD: patch-m68k,v 1.1 2001/01/24 11:24:12 tsutsui Exp $

--- ./ld/configure.tgt.orig	Sat Dec  9 21:17:55 2000
+++ ./ld/configure.tgt	Sat Dec  9 21:25:20 2000
@@ -134,6 +134,7 @@
 m68*-*-lynxos*)		targ_emul=m68klynx ;;
 m68*-hp*-netbsd*)	targ_emul=m68k4knbsd ;;
+m68*-*-netbsdelf*)	targ_emul=m68kelfnbsd ;;
 m68*-*-netbsd*)		targ_emul=m68knbsd ;;
 m68*-*-psos*)		targ_emul=m68kpsos ;;
 m68*-*-rtems*)		targ_emul=m68kcoff ;;
 hppa*-*-*elf*)		targ_emul=hppaelf ;;
--- /dev/null	Sat Dec  9 21:20:06 2000
+++ ./ld/emulparams/m68kelfnbsd.sh	Sat Dec  9 21:23:39 2000
@@ -0,0 +1,12 @@
+SCRIPT_NAME=elf
+OUTPUT_FORMAT="elf32-m68k"
+TEXT_START_ADDR=0x2000
+TARGET_PAGE_SIZE=0x2000
+MAXPAGESIZE=0x2000
+NONPAGED_TEXT_START_ADDR=${TEXT_START_ADDR}
+ARCH=m68k
+MACHINE=
+NOP=0x4e75
+TEMPLATE_NAME=elf32
+GENERATE_SHLIB_SCRIPT=yes
+ELFSIZE=32
--- ./ld/Makefile.in.orig	Sat Dec  9 23:49:47 2000
+++ ./ld/Makefile.in	Sun Dec 10 00:40:28 2000
@@ -225,6 +225,7 @@
 	em68klinux.o \
 	em68klynx.o \
 	em68knbsd.o \
+	em68kelfnbsd.o \
 	em68kpsos.o \
 	em88kbcs.o \
 	emipsbig.o \
@@ -932,6 +933,9 @@
 em68knbsd.c:	$(srcdir)/emulparams/m68knbsd.sh \
   $(srcdir)/emultempl/generic.em $(srcdir)/scripttempl/aout.sc ${GEN_DEPENDS}
 	${GENSCRIPTS} m68knbsd "$(tdir_m68knbsd)"
+em68kelfnbsd.c:	$(srcdir)/emulparams/m68kelfnbsd.sh \
+  $(srcdir)/emultempl/elf32.em $(srcdir)/scripttempl/elf.sc ${GEN_DEPENDS}
+	${GENSCRIPTS} m68kelfnbsd "$(tdir_m68kelfnbsd)"
 em68kpsos.c:	$(srcdir)/emulparams/m68kpsos.sh \
   $(srcdir)/emultempl/elf32.em $(srcdir)/scripttempl/psos.sc ${GEN_DEPENDS}
 	${GENSCRIPTS} m68kpsos "$(tdir_m68kpsos)"
--- ./bfd/config.bfd.orig	Mon Jan 22 21:24:53 2001
+++ ./bfd/config.bfd	Mon Jan 22 21:27:35 2001
@@ -324,14 +324,19 @@
     targ_defvec=m68klynx_coff_vec
     targ_selvecs=m68klynx_aout_vec
     ;;
-  m68*-hp*-netbsd*)
+  m68*-*-netbsdelf*)
+    targ_defvec=bfd_elf32_m68k_vec
+    targ_selvecs="m68k4knetbsd_vec hp300bsd_vec bfd_elf32_m68k_vec sunos_big_vec"
+    targ_underscore=yes
+    ;;
+  m68*-hp*-netbsd*0.* | m68*-hp*-netbsd*1.[012]*)
     targ_defvec=m68k4knetbsd_vec
-    targ_selvecs="m68knetbsd_vec hp300bsd_vec sunos_big_vec"
+    targ_selvecs="m68knetbsd_vec hp300bsd_vec bfd_elf32_m68k_vec sunos_big_vec"
     targ_underscore=yes
     ;;
   m68*-*-netbsd* | m68*-*-openbsd*)
     targ_defvec=m68knetbsd_vec
-    targ_selvecs="m68k4knetbsd_vec hp300bsd_vec sunos_big_vec"
+    targ_selvecs="m68k4knetbsd_vec hp300bsd_vec bfd_elf32_m68k_vec sunos_big_vec"
     targ_underscore=yes
     ;;
   m68*-*-sunos* | m68*-*-os68k* | m68*-*-vxworks* | m68*-netx-* | \
