--- pico/makefile.neb.orig	Fri Nov 21 17:53:07 1997
+++ pico/makefile.neb	Fri Nov 21 17:54:36 1997
@@ -28,12 +28,12 @@
 #
 
 #includes symbol info for debugging 
-DASHO=		-g
+DASHO=		# -g
 #for normal build
 #DASHO=		-O
 
 STDCFLAGS=	-Dneb -DJOB_CONTROL -DANSI -DPOSIX -DMOUSE
-CFLAGS=		$(EXTRACFLAGS) $(DASHO) $(STDCFLAGS)
+CFLAGS+=		$(EXTRACFLAGS) $(DASHO) $(STDCFLAGS)
 
 # switches for library building
 LIBCMD=		ar
@@ -46,12 +46,17 @@
 		composer.o display.o file.o fileio.o line.o osdep.o \
 		pico.o random.o region.o search.o spell.o tcap.o window.o word.o
 
+# Lets be elite and not retype in the above
+SOFILES=	${OFILES:.o=.so}
+
 CFILES=		attach.c ansi.c basic.c bind.c browse.c buffer.c \
 		composer.c display.c file.c fileio.c line.c osdep.c \
 		pico.c random.c region.c search.c spell.c tcap.c window.c word.c
 
 HFILES=		estruct.h edef.h efunc.h ebind.h pico.h osdep.h
 
+# Need this for the shared library rule to work correctly
+.SUFFIXES: .o .so
 
 #
 # dependencies for the Unix versions of pico and libpico.a
@@ -70,15 +75,22 @@
 		$(LIBCMD) $(LIBARGS) libpico.a $(OFILES)
 		$(RANLIB) libpico.a
 
-pico:		main.c libpico.a
-		$(CC) $(CFLAGS) main.c libpico.a $(LIBS) -o pico
+libpico.so.1.3:	osdep.c osdep.h $(SOFILES)
+ 		ld -Bshareable -x -o libpico.so.1.3 $(SOFILES)
+ 
+pico:		main.c libpico.so.1.3
+ 		$(CC) $(CFLAGS) main.c -L. -lpico $(LIBS) -o pico
 
-pilot:		pilot.c libpico.a
-		$(CC) $(CFLAGS) pilot.c libpico.a $(LIBS) -o pilot
+pilot:		pilot.c libpico.so.1.3
+ 		$(CC) $(CFLAGS) pilot.c -L. -lpico $(LIBS) -o pilot
+ 
+.c.so:		; $(CC) -fPIC -DPIC -c $(CFLAGS) ${@:.so=.c} -o $@
 
 .c.o:		; $(CC) -c $(CFLAGS) $*.c
 
 $(OFILES):	$(HFILES)
 
+$(SOFILES):	$(HFILES)
+ 
 clean:
-		rm -f *.a *.o *~ osdep.c osdep.h pico pilot
+ 		rm -f *.a *.so.1.3 *.o *.so *~ osdep.c osdep.h pico pilot
