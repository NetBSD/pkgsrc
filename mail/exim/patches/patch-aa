$NetBSD: patch-aa,v 1.5 2003/09/02 10:33:41 abs Exp $

--- Local/Makefile.pkgsrc.orig	2003-08-29 18:17:32.000000000 +0100
+++ Local/Makefile.pkgsrc
@@ -98,7 +98,7 @@
 # /usr/local/sbin. The installation script will try to create this directory,
 # and any superior directories, if they do not exist.
 
-BIN_DIRECTORY=/usr/exim/bin
+BIN_DIRECTORY=@PREFIX@/sbin
 
 
 #------------------------------------------------------------------------------
@@ -114,7 +114,7 @@ BIN_DIRECTORY=/usr/exim/bin
 # don't exist. It will also install a default runtime configuration if this
 # file does not exist.
 
-CONFIGURE_FILE=/usr/exim/configure
+CONFIGURE_FILE=@PKG_SYSCONFDIR@/configure
 
 # It is possible to specify a colon-separated list of files for CONFIGURE_FILE.
 # In this case, Exim will use the first of them that exists when it is run.
@@ -132,7 +132,8 @@ CONFIGURE_FILE=/usr/exim/configure
 # owner of a local mailbox.) Specifying these values as root is very strongly
 # discouraged. These values are compiled into the binary.
 
-EXIM_USER=
+EXIM_USER=@EXIM_USER@
+EXIM_GROUP=@EXIM_GROUP@
 
 # If the setting of EXIM_USER is numeric (e.g. EXIM_USER=42), there must
 # also be a setting of EXIM_GROUP. If, on the other hand, you use a name
@@ -213,7 +214,7 @@ TRANSPORT_SMTP=yes
 # This one is special-purpose, and commonly not required, so it is not
 # included by default.
 
-# TRANSPORT_LMTP=yes
+TRANSPORT_LMTP=yes
 
 
 #------------------------------------------------------------------------------
@@ -222,9 +223,9 @@ TRANSPORT_SMTP=yes
 # MBX, is included only when requested. If you do not know what this is about,
 # leave these settings commented out.
 
-# SUPPORT_MAILDIR=yes
-# SUPPORT_MAILSTORE=yes
-# SUPPORT_MBX=yes
+SUPPORT_MAILDIR=yes
+SUPPORT_MAILSTORE=yes
+SUPPORT_MBX=yes
 
 
 #------------------------------------------------------------------------------
@@ -289,7 +290,7 @@ LOOKUP_LSEARCH=yes
 # files are defaulted in the OS/Makefile-Default file, but can be overridden in
 # local OS-specific make files.
 
-EXIM_MONITOR=eximon.bin
+# EXIM_MONITOR=eximon.bin
 
 
 
@@ -310,9 +311,9 @@ EXIM_MONITOR=eximon.bin
 # included in the Exim binary. You will then need to set up the run time
 # configuration to make use of the mechanism(s) selected.
 
-# AUTH_CRAM_MD5=yes
-# AUTH_PLAINTEXT=yes
-# AUTH_SPA=yes
+AUTH_CRAM_MD5=yes
+AUTH_PLAINTEXT=yes
+AUTH_SPA=yes
 
 
 #------------------------------------------------------------------------------
@@ -365,10 +366,11 @@ HEADER_DECODE_TO="ISO-8859-1"
 # leave these settings commented out.
 
 # This setting is required for any TLS support (either OpenSSL or GnuTLS)
-# SUPPORT_TLS=yes
+SUPPORT_TLS=yes
 
 # Uncomment this setting if you are using OpenSSL
-# TLS_LIBS=-lssl -lcrypto
+TLS_LIBS=-L${SSLBASE}/lib -Wl,-R${SSLBASE}/lib -lssl -lcrypto
+TLS_INCLUDE=-I${SSLBASE}/include
 
 # Uncomment these settings if you are using GnuTLS
 # USE_GNUTLS=yes
@@ -402,6 +404,19 @@ HEADER_DECODE_TO="ISO-8859-1"
 # You don't need to set TLS_INCLUDE if the relevant directories are already
 # specified in INCLUDE.
 
+#------------------------------------------------------------------------------
+# On systems which support dynamic loading of shared libraries, Exim can
+# load a local_scan function specified in its config file instead of having
+# to be recompiled with the desired local_scan function. For a full
+# description of the API to this function, see the Exim specification.
+
+DLOPEN_LOCAL_SCAN=yes
+
+# If you set DLOPEN_LOCAL_SCAN, then you need to include -rdynamic in the
+# linker flags.  Without it, the loaded .so won't be able to access any
+# functions from exim.
+
+LFLAGS=-rdynamic
 
 #------------------------------------------------------------------------------
 # The default distribution of Exim contains only the plain text form of the
@@ -432,7 +447,7 @@ HEADER_DECODE_TO="ISO-8859-1"
 # %s. This will be replaced by one of the strings "main", "panic", or "reject"
 # to form the final file names. Some installations may want something like this:
 
-# LOG_FILE_PATH=/var/log/exim_%slog
+LOG_FILE_PATH=/var/log/exim/%s
 
 # which results in files with names /var/log/exim_mainlog, etc. The directory
 # in which the log files are placed must exist; Exim does not try to create
@@ -562,14 +577,14 @@ ZCAT_COMMAND=/usr/bin/zcat
 # this setting. See the manual section entitled "Use of tcpwrappers" in the
 # chapter on building and installing Exim.
 
-# USE_TCP_WRAPPERS=yes
+USE_TCP_WRAPPERS=yes
 
 # You may well also have to specify a local "include" file and an additional
 # library for TCP wrappers, so you probably need something like this:
 
 #  USE_TCP_WRAPPERS=yes
 #  CFLAGS=-O -I/usr/local/include
-#  EXTRALIBS_EXIM=-L/usr/local/lib -lwrap
+EXTRALIBS_EXIM=-lwrap
 
 # but of course there may need to be other things in CFLAGS and EXTRALIBS_EXIM
 # as well.
@@ -618,11 +633,11 @@ SYSTEM_ALIASES_FILE=/etc/aliases
 # haven't got Perl, Exim will still build and run; you just won't be able to
 # use those utilities.
 
-# CHOWN_COMMAND=/usr/bin/chown
-# CHGRP_COMMAND=/usr/bin/chgrp
-# MV_COMMAND=/bin/mv
-# RM_COMMAND=/bin/rm
-# PERL_COMMAND=/usr/bin/perl
+CHOWN_COMMAND=@CHOWN@
+CHGRP_COMMAND=@CHGRP@
+MV_COMMAND=@MV@
+RM_COMMAND=@RM@
+PERL_COMMAND=@PERL5@
 
 
 #------------------------------------------------------------------------------
@@ -816,7 +831,7 @@ TMPDIR="/tmp"
 # (process id) to a file so that it can easily be identified. The path of the
 # file can be specified here. Some installations may want something like this:
 
-# PID_FILE_PATH=/var/lock/exim.pid
+PID_FILE_PATH=/var/run/exim.pid
 
 # If PID_FILE_PATH is not defined, Exim writes a file in its spool directory
 # using the name "exim-daemon.pid".
