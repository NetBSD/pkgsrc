$NetBSD: patch-af,v 1.1 2004/03/14 19:26:37 abs Exp $

--- src/daemon.c.orig	2003-08-18 13:52:53.000000000 +0100
+++ src/daemon.c
@@ -719,6 +719,7 @@ daemon_go(void)
 {
 int *listen_sockets = NULL;
 int listen_socket_count = 0;
+int fd;
 ip_address_item *addresses = NULL;
 
 /* If any debugging options are set, turn on the D_pid bit so that all
@@ -736,9 +737,17 @@ if (background_daemon)
   {
   log_close_all();  /* Just in case anything was logged earlier */
   search_tidyup();  /* Just in case any were used in reading the config. */
-  close(0);         /* Get rid of stdin/stdout/stderr */
+  /* Get rid of stdin/stdout/stderr 
+  close(0);
   close(1);
   close(2);
+  */
+  /* Instead of closing, dup them to /dev/null */
+  fd= open( "/dev/null", O_RDWR );
+  dup2( fd, 0 ); 
+  dup2( fd, 1 ); 
+  dup2( fd, 2 );
+  if( fd > 2 ) close( fd );
   log_stderr = NULL;  /* So no attempt to copy paniclog output */
 
   /* If the parent process of this one has pid == 1, we are re-initializing the
