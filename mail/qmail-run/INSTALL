QMAIL_QUEUE_EXTRA=@QMAIL_QUEUE_EXTRA@

psmsg='#
# This file was auto-generated by pkgsrc.'

case ${STAGE} in

POST-INSTALL)
	cd ${PREFIX}/share/qmail/setup && ./config-fast-pkgsrc `./hostname`

	cd ${PKG_SYSCONFDIR}/.pkgsrc-defaults-do-not-edit
	for i in locals rcpthosts; do
		${SORT} -u ${i} > ${i}.tmp && ${MV} ${i}.tmp ${i}
	done

	cd ${PKG_SYSCONFDIR}
	for i in defaultdomain locals me plusdomain rcpthosts; do
		[ -f control/${i} ] \
			|| ${CP} .pkgsrc-defaults-do-not-edit/${i} control
	done

	cd ${PKG_SYSCONFDIR}/alias
	for i in postmaster mailer-daemon root; do
		${TOUCH} .qmail-${i}
		${CHMOD} 644 .qmail-${i}
	done
	if ! [ -z ${QMAIL_QUEUE_EXTRA} ]; then
		${ECHO} "$psmsg" >> .qmail-${QMAIL_QUEUE_EXTRA}
		${CHMOD} 644 .qmail-${QMAIL_QUEUE_EXTRA}
	fi

	cd ${PKG_SYSCONFDIR}
	for i in ofmip pop3 smtp; do
		${CHMOD} 644 tcp.${i}
		${PREFIX}/bin/tcprules tcp.${i}.cdb tcp.${i}.tmp < tcp.${i}
		${CHMOD} 644 tcp.${i}.cdb
	done

	;;
esac
