#! /bin/sh

if [ ! -f ${DISTDIR}/vulnerabilities ] ;then
    echo "** Missing ${DISTDIR}/vulnerabilities" 1>&2
    echo "** run download-vulnerability-list" 1>&2
    exit 1
fi

if [ -n "$(find ${DISTDIR}/vulnerabilities -mtime +7)" ]
then
    echo "** ${DISTDIR}/vulnerabilities more than a week old" 1>&2
    echo "** run download-vulnerability-list" 1>&2
    exit 1
fi

${AWK} '
	/^#.*/ { next }
	NF == 0 { next }
	{ cmd = sprintf("${PKG_INFO} -qe \"%s\" && echo Package \"`${PKG_INFO} -e \"%s\"`\" has a %s vulnerability, see %s", $1, $1, $2, $3);
	  system(cmd); }
' ${DISTDIR}/vulnerabilities

exit 0
