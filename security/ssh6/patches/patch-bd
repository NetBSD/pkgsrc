$NetBSD: patch-bd,v 1.1 2000/03/20 02:25:42 itojun Exp $

--- readconf.c.orig	Wed May 12 07:19:27 1999
+++ readconf.c	Fri Dec 24 21:50:42 1999
@@ -170,7 +170,13 @@
   oGlobalKnownHostsFile, oUserKnownHostsFile, oConnectionAttempts,
   oBatchMode, oStrictHostKeyChecking, oCompression, oCompressionLevel,
   oKeepAlives, oUsePrivilegedPort, oKerberosAuthentication,
+#ifdef AFS
+  oAFSTokenPassing,
+#endif /* AFS */
   oKerberosTgtPassing, oClearAllForwardings, oNumberOfPasswordPrompts,
+#ifdef ENABLE_ANOTHER_PORT_TRY
+  oAnotherPort,
+#endif /* ENABLE_ANOTHER_PORT_TRY */
   oXauthPath, oGatewayPorts, oPasswordPromptLogin, oPasswordPromptHost
 } OpCodes;
 
@@ -194,6 +200,9 @@
   { "hostname", oHostName },
   { "proxycommand", oProxyCommand },
   { "port", oPort },
+#ifdef ENABLE_ANOTHER_PORT_TRY
+  { "anotherport", oAnotherPort },
+#endif /* ENABLE_ANOTHER_PORT_TRY */
   { "cipher", oCipher },
   { "remoteforward", oRemoteForward },
   { "localforward", oLocalForward },
@@ -213,6 +222,9 @@
   { "useprivilegedport", oUsePrivilegedPort },
   { "kerberosauthentication", oKerberosAuthentication },
   { "kerberostgtpassing", oKerberosTgtPassing },
+#ifdef AFS
+  { "afstokenpassing", oAFSTokenPassing },
+#endif /* AFS */
   { "clearallforwardings", oClearAllForwardings },
   { "numberofpasswordprompts", oNumberOfPasswordPrompts },
   { "xauthlocation", oXauthPath },
@@ -354,6 +366,12 @@
       intptr = &options->kerberos_tgt_passing;
       goto parse_flag;
       
+#ifdef AFS
+    case oAFSTokenPassing:
+      intptr = &options->afs_token_passing;
+      goto parse_flag;
+#endif /* AFS */
+      
     case oFallBackToRsh:
       intptr = &options->fallback_to_rsh;
       goto parse_flag;
@@ -497,6 +515,12 @@
 	*intptr = value;
       break;
       
+#ifdef ENABLE_ANOTHER_PORT_TRY
+    case oAnotherPort:
+      intptr = &options->another_port;
+      goto parse_int;
+#endif /* ENABLE_ANOTHER_PORT_TRY */
+
     case oConnectionAttempts:
       intptr = &options->connection_attempts;
       goto parse_int;
@@ -678,6 +702,9 @@
   options->rsa_authentication = -1;
   options->kerberos_authentication = -1;
   options->kerberos_tgt_passing = -1;
+#ifdef AFS
+  options->afs_token_passing = -1;
+#endif /* AFS */
   options->tis_authentication = -1;
   options->password_authentication = -1;
   options->rhosts_rsa_authentication = -1;
@@ -689,6 +716,9 @@
   options->keepalives = -1;
   options->compression_level = -1;
   options->port = -1;
+#ifdef ENABLE_ANOTHER_PORT_TRY
+  options->another_port = -1;
+#endif /* ENABLE_ANOTHER_PORT_TRY */
   options->connection_attempts = -1;
   options->number_of_password_prompts = -1;
   options->password_prompt_login = -1;
@@ -724,17 +754,19 @@
   if (options->rsa_authentication == -1)
     options->rsa_authentication = 1;
   if (options->kerberos_authentication == -1)
-#if defined(KERBEROS) && defined(KRB5)
+#if defined(KRB4) || defined(KRB5)
     options->kerberos_authentication = 1;
-#else  /* defined(KERBEROS) && defined(KRB5) */
+#else
     options->kerberos_authentication = 0;
-#endif /* defined(KERBEROS) && defined(KRB5) */
+#endif /* defined(KRB4) ||  defined(KRB5) */
   if (options->kerberos_tgt_passing == -1)
-#if defined(KERBEROS_TGT_PASSING) && defined(KRB5)
+#if defined(AFS)
     options->kerberos_tgt_passing = 1;
-#else  /* defined(KERBEROS_TGT_PASSING) && defined(KRB5) */
+  if (options->afs_token_passing == -1)
+    options->afs_token_passing = 1;
+#else
     options->kerberos_tgt_passing = 0;
-#endif /* defined(KERBEROS_TGT_PASSING) && defined(KRB5) */
+#endif /* AFS */
   if (options->tis_authentication == -1)
     options->tis_authentication = 0;
   if (options->password_authentication == -1)
@@ -759,6 +791,10 @@
     options->compression_level = 6;
   if (options->port == -1)
     options->port = 0; /* Filled in ssh_connect. */
+#ifdef ENABLE_ANOTHER_PORT_TRY
+  if (options->another_port == -1)
+    options->another_port = 0;
+#endif /* ENABLE_ANOTHER_PORT_TRY */
   if (options->connection_attempts == -1)
     options->connection_attempts = 4;
   if (options->number_of_password_prompts == -1)
