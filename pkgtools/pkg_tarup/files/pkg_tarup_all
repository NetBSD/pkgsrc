#! @SH@
#
# $Id: pkg_tarup_all,v 1.3 2004/04/20 16:26:07 wiz Exp $
#
# Tar up installed package plus dependencies
#
# (c) Copyright 2003 Hubert Feyrer <hubert@feyrer.de>
#

PREFIX=${PREFIX:-@PREFIX@}

PATH=/sbin:/usr/sbin:/bin:/usr/bin:${PREFIX}/sbin:${PREFIX}/bin:@PKG_TOOLS_BIN@
export PATH

AWK=${AWK:-@AWK@}
ECHO=${ECHO:-@ECHO@}
HEAD=${HEAD:-@HEAD@}
ID=${ID:-@ID@}
SU=${SU:-@SU@}
PKG_INFO=${PKG_INFO:-@PKG_INFO@}

if [ `${ID} -u` != 0 ]; then
	${ECHO} "Becoming root@`/bin/hostname` to create binary packages"
	${ECHO} -n "`${ECHO} ${SU} | ${AWK} '{ print $1 }'` ";\
	exec ${SU} root -c "$0 $@"
fi

# 1. dependencies
pkg_info -qf "$1" \
| grep @pkgdep \
| ${AWK} '{print $2}' \
| xargs ${PREFIX}/bin/pkg_tarup

# 2. the pkg itself
${PREFIX}/bin/pkg_tarup "$1"
