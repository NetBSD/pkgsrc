# $NetBSD: fonts,v 1.1.6.1 2003/12/30 16:04:35 agc Exp $
#
# Handle font databases; used by fonts.mk.
#

FONTS_TTF="@FONTS_TTF@"
FONTS_TTF_DIRS="@FONTS_TTF_DIRS@"
FONTS_TYPE1="@FONTS_TYPE1@"
FONTS_TYPE1_DIRS="@FONTS_TYPE1_DIRS@"
FONTS_X11="@FONTS_X11@"
FONTS_X11_DIRS="@FONTS_X11_DIRS@"
TTMKFDIR="@TTMKFDIR@"
TYPE1INST="@TYPE1INST@"
MKFONTDIR="@MKFONTDIR@"

case ${STAGE} in
POST-INSTALL|POST-DEINSTALL)
	${ECHO} "===> Updating font databases"
	if [ "${FONTS_TTF}" = "YES" ]; then
		for d in ${FONTS_TTF_DIRS}; do
			if [ -z "`cd $d ; ${LS} | ${GREP} -v ^fonts | ${GREP} -v ^Fontmap`" ]; then
				${RM} -f $d/fonts* $d/Fontmap*
				${RMDIR} $d >/dev/null 2>&1
			else
				( cd $d && ${TTMKFDIR} >fonts.dir 2>/dev/null )
			fi
		done
	fi
	if [ "${FONTS_TYPE1}" = "YES" ]; then
		for d in ${FONTS_TYPE1_DIRS}; do
			if [ -z "`cd $d ; ${LS} | ${GREP} -v ^fonts | ${GREP} -v ^Fontmap`" ]; then
				${RM} -f $d/fonts* $d/Fontmap*
				${RMDIR} $d >/dev/null 2>&1
			else
				( cd $d && ${TYPE1INST} >/dev/null 2>&1 )
			fi
		done
	fi
	if [ "${FONTS_X11}" = "YES" ]; then
		for d in ${FONTS_X11_DIRS}; do
			if [ -z "`cd $d ; ${LS} | ${GREP} -v ^fonts | ${GREP} -v ^Fontmap`" ]; then
				${RM} -f $d/fonts* $d/Fontmap*
				${RMDIR} $d >/dev/null 2>&1
			else
				( cd $d && ${MKFONTDIR} >/dev/null 2>&1 )
			fi
		done
	fi
	;;
esac
