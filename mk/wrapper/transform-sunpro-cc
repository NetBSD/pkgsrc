# $NetBSD: transform-sunpro-cc,v 1.17 2006/11/29 17:36:15 rillig Exp $
#
# Copyright (c) 2004 The NetBSD Foundation, Inc.
# All rights reserved.
#
# This code is derived from software contributed to The NetBSD Foundation
# by Johnny C. Lam.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#        This product includes software developed by the NetBSD
#        Foundation, Inc. and its contributors.
# 4. Neither the name of The NetBSD Foundation nor the names of its
#    contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
# ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
# TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.

transform_setname "transform-sunpro-cc"
case $arg in

-E)
	transform_pass ;;

-MM)
	# Create dependency lines for Makefiles
	transform_to "-xM1"
	;;

-O[12345])
	# SunPro can handle -xO<n> (n={1|2|3|4|5}), so optimistically
	# convert those GCC -O<n> values to -xO<n>.
	transform_to "-xO${arg#-O}"
	;;

-O?*)
	# Silently ignore all other -O* options, except for "-O", which
	# SunPro interprets as asking for the default optimization level.
	transform_discard
	;;

-Wl,-R*)
	# Directories for the runtime library search path are passed via
	# simply "-R<dir>", not "-Wl,-R<dir>".
	transform_to "${arg#-Wl,}"
	;;
-R*)
	transform_pass
	;;

-Wl,-soname=*)
	# SunPro uses -h to set the shared object name.
	transform_to "-h${arg#-Wl,-soname=}"
	;;

-Wl,--export-dynamic|\
-Wl,-E)
	# Solaris' linker exports all dynamic symbols by default when
	# building a shared object.
	transform_discard
	;;

-Wl,*)
	# SunPro compiler accepts -Wl,* so just pass it on through.
	addtocache=yes
	;;

-W*)
	# SunPro compilers don't understand any other -W* arguments,
	# so just silently ignore the rest.
	transform_discard
	;;

-static)
	# Solaris' linker uses -Bstatic to create static objects.
	transform_to "-Bstatic"
	;;

--export-dynamic|\
-shared)
	# Solaris' linker uses -G to create shared objects.
	transform_to "-G"
	;;

-f[Pp][Ii][Cc])
	# SunPro uses -Kpic to create position independent code.
	transform_to "-Kpic"
	;;

-pthread)
	# SunPro needs -mt -lpthread for POSIX threads.
	transform_to "-mt -lpthread"
	split_arg=yes
	;;

-fast)
	# -fast implies -xlibmopt, which uses the optimized math
	# routines in libsunmath. libsunmath is only available as part of
	# SunPro, so disable the use of the optimized math library
	# (at least until it can be statically linked).
	transform_to "-fast -xnolibmopt"
	split_arg=yes
	;;

-fd|\
-features*|\
-flags|\
-flteval*|\
-fnonstd*|\
-fns*|\
-fprecision*|\
-fround*|\
-fsimple*|\
-fsingle|\
-fstore|\
-ftrap*)
	# Pass through -f flags that SunPro understands.
	addtocache=yes
	;;

-f*)
	# Ignore all other -f flags.
	transform_discard
	;;

-ansi|\
-pedantic|\
-pipe|\
-traditional)
	# Ignore some flags that are unnecessary for SunPro.
	transform_discard
	;;

-[DILlU]*|\
-[cgOo])
	transform_pass
	;;
-*)
	transform_pass_with_warning
	;;
esac
