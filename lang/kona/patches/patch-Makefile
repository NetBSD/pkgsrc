$NetBSD: patch-Makefile,v 1.1 2022/11/09 16:58:35 nikita Exp $

patch for reproducibility (SOURCE_DATE_EPOCH),
sent upstream.

--- Makefile.orig	2022-11-09 17:18:35.887846604 +0100
+++ Makefile	2022-11-09 17:19:45.705977471 +0100
@@ -127,8 +127,15 @@
 k_dyn: src/kbuild.h $(OBJS)
 	$(CC) ${CFLAGS} $(OBJS) -rdynamic -o $@ $(LDFLAGS)
 
+DATE_FMT = +%Y-%m-%d
+ifdef SOURCE_DATE_EPOCH
+	BUILD_DATE := $(shell date -u -d "@$(SOURCE_DATE_EPOCH)" "$(DATE_FMT)" 2>/dev/null || date -u -r "$(SOURCE_DATE_EPOCH)" "$(DATE_FMT)" 2>/dev/null || date -u "$(DATE_FMT)")
+else
+	BUILD_DATE := $(shell date "$(DATE_FMT)")
+endif
+
 src/kbuild.h:
-	echo "#define KBUILD_DATE \"`date +%Y-%m-%d`\"" >$@
+	echo "#define KBUILD_DATE \"$(BUILD_DATE)\"" >$@
 
 test: k_test
 
