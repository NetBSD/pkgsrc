$NetBSD: patch-ab,v 1.4 1999/04/10 21:49:05 tron Exp $

--- ../tcl/unix/Makefile.in.orig	Mon Dec  7 04:47:24 1998
+++ ../tcl/unix/Makefile.in	Mon Apr  5 23:08:01 1999
@@ -36,7 +36,7 @@
 
 LIBS = ${TCLX_LD_SEARCH_FLAGS} @SHARED_LIBS@
 
-ALL_LIBS = ${TCLX_BUILD_LIB_SPEC} ${TCL_LIB} ${TCLX_LIBS} ${TCL_LIBS} \
+ALL_LIBS = ${TCLX_STLIB_NAME:.a=.la} ${TCL_LIB} ${TCLX_LIBS} ${TCL_LIBS} \
 	   ${XLDLIBS} ${TCLX_CC_SEARCH_FLAGS}
 
 STATIC_LIBS = ${TCLX_STLIB_NAME} ${TCL_UNIX_DIR}/${TCL_STLIB_NAME} \
@@ -124,14 +124,14 @@
 # If a link fails, purge the executable, as some systems leave invalid
 # executables around.
 #
-all: tcl checkup RUNTIME tclXtest
+all: tcl checkup RUNTIME
 
 static:	tcl.static tclXtest.static
 
 standalone: tcl.standalone tclXtest.standalone hello
 
-tcl: tclXAppInit.o @TCLX_SHLIB_BUILD_REF@ @TCLX_STLIB_BUILD_REF@ Makefile
-	${CC} ${LD_SWITCHES} tclXAppInit.o ${ALL_LIBS} \
+tcl: tclXAppInit.o ${TCLX_STLIB_NAME:.a=.la} Makefile
+	${LIBTOOL} --mode=link ${CC} ${LD_SWITCHES} tclXAppInit.o ${ALL_LIBS} \
 	    -o $@ || (rm -f $@; exit 1)
 
 tcl.static: tclXAppInit.o @TCLX_STLIB_BUILD_REF@ Makefile
@@ -142,9 +142,8 @@
 	${CC} ${LD_SWITCHES} tclXAppInitSA.o ${STATIC_LIBS} \
 	    -o $@ || (rm -f $@; exit 1)
 
-${TCLX_STLIB_NAME}: ${OBJS}
-	${AR} cr ${TCLX_STLIB_NAME} ${OBJS}
-	${RANLIB} ${TCLX_STLIB_NAME}
+${TCLX_STLIB_NAME:.a=.la}: ${OBJS}
+	${LIBTOOL} --mode=link ${CC} -rpath ${PREFIX}/lib -version-info 1:0 -o $@ ${OBJS:.o=.lo}
 
 @TCLX_SHLIB_BUILD_TARGET@: ${SOBJS}
 	rm -f ${TCLX_SHLIB_NAME}
@@ -312,17 +311,10 @@
 	    ${INSTALL_ROOT}${TCLX_INST_RUNTIME}
 
 install-exec:
-	${INSTCOPY} tcl ${INSTALL_ROOT}${TCLX_INST_BIN}
-	${STRIP} ${INSTALL_ROOT}${TCLX_INST_BIN}/tcl
-	if test "X@TCLX_STLIB_BUILD_REF@" != "X"; then \
-	    ${INSTCOPY} ${TCLX_STLIB_NAME} ${INSTALL_ROOT}${TCLX_INST_LIB}; \
-	    ${RANLIB} ${INSTALL_ROOT}${TCLX_INST_LIB}/${TCLX_STLIB_NAME}; \
-	fi
+	${LIBTOOL} --mode=install ${BSD_INSTALL_PROGRAM} tcl ${INSTALL_ROOT}${TCLX_INST_BIN}
 	${INSTCOPY} tclxConfig.sh ${INSTALL_ROOT}${TCLX_INST_LIB}
-	if test "@BUILD_SHARED@" = "YES"; then \
-	    ${INSTCOPY} ${TCLX_SHLIB_NAME} ${INSTALL_ROOT}${TCLX_INST_LIB} ;\
-	    ${INSTCOPY} pkgIndex.tcl ${INSTALL_ROOT}${TCLX_EXEC_RUNTIME} ;\
-	fi
+	${LIBTOOL} --mode=install ${BSD_INSTALL_DATA} ${TCLX_STLIB_NAME:.a=.la} ${PREFIX}/lib
+	${INSTCOPY} pkgIndex.tcl ${INSTALL_ROOT}${TCLX_EXEC_RUNTIME}
 
 #------------------------------------------------------------------------------
 config:
@@ -357,53 +349,53 @@
 # Dependencies for generating objects.
 #
 tclXlibInit.o: ${TCLX_GENERIC_DIR}/tclXlibInit.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXlibInit.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXlibInit.c
 
 tclXcmdInit.o: ${TCLX_GENERIC_DIR}/tclXcmdInit.c
-	${CC} -c ${CC_SWITCHES}  ${TCLX_GENERIC_DIR}/tclXcmdInit.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES}  ${TCLX_GENERIC_DIR}/tclXcmdInit.c
 
 tclXAppInit.o: ${TCLX_UNIX_SRC_DIR}/tclXAppInit.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXAppInit.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXAppInit.c
 
 tclXbsearch.o: ${TCLX_GENERIC_DIR}/tclXbsearch.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXbsearch.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXbsearch.c
 
 tclXcmdloop.o: ${TCLX_GENERIC_DIR}/tclXcmdloop.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXcmdloop.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXcmdloop.c
 
 tclXdebug.o: ${TCLX_GENERIC_DIR}/tclXdebug.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXdebug.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXdebug.c
 
 tclXdup.o: ${TCLX_GENERIC_DIR}/tclXdup.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXdup.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXdup.c
 
 tclXfcntl.o: ${TCLX_GENERIC_DIR}/tclXfcntl.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXfcntl.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXfcntl.c
 
 tclXfilecmds.o: ${TCLX_GENERIC_DIR}/tclXfilecmds.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXfilecmds.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXfilecmds.c
 
 tclXfilescan.o: ${TCLX_GENERIC_DIR}/tclXfilescan.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXfilescan.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXfilescan.c
 
 tclXflock.o: ${TCLX_GENERIC_DIR}/tclXflock.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXflock.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXflock.c
 
 tclXfstat.o: ${TCLX_GENERIC_DIR}/tclXfstat.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXfstat.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXfstat.c
 
 tclXgeneral.o: ${TCLX_GENERIC_DIR}/tclXgeneral.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXgeneral.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXgeneral.c
 
 tclXhandles.o: ${TCLX_GENERIC_DIR}/tclXhandles.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXhandles.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXhandles.c
 
 tclXinit.o: ${TCLX_GENERIC_DIR}/tclXinit.c Makefile
-	${CC} -c ${CC_SWITCHES} -DTCLX_LIBRARY=\"${TCLX_INST_RUNTIME}\" \
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} -DTCLX_LIBRARY=\"${TCLX_INST_RUNTIME}\" \
 	    ${TCLX_GENERIC_DIR}/tclXinit.c
 
 tclXinitSA.o: ${TCLX_GENERIC_DIR}/tclXinitSA.c ${STANDALONE_SRCS}
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXinitSA.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXinitSA.c
 
 tclXAppInitSA.c: ${TCLX_UNIX_SRC_DIR}/tclXAppInit.c
 	rm -f tclXAppinitSA.c
@@ -412,82 +404,82 @@
 	    ${TCLX_UNIX_SRC_DIR}/tclXAppInit.c >tclXAppInitSA.c
 
 tclXinitDSA.o: ${TCLX_GENERIC_DIR}/tclXinitDSA.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXinitDSA.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXinitDSA.c
 
 tclXkeylist.o: ${TCLX_GENERIC_DIR}/tclXkeylist.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXkeylist.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXkeylist.c
 
 tclXlgets.o: ${TCLX_GENERIC_DIR}/tclXlgets.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXlgets.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXlgets.c
 
 tclXlib.o: ${TCLX_GENERIC_DIR}/tclXlib.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXlib.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXlib.c
 
 tclXlist.o: ${TCLX_GENERIC_DIR}/tclXlist.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXlist.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXlist.c
 
 tclXmath.o: ${TCLX_GENERIC_DIR}/tclXmath.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXmath.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXmath.c
 
 tclXmsgcat.o: ${TCLX_GENERIC_DIR}/tclXmsgcat.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXmsgcat.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXmsgcat.c
 
 tclXprocess.o: ${TCLX_GENERIC_DIR}/tclXprocess.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXprocess.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXprocess.c
 
 tclXprofile.o: ${TCLX_GENERIC_DIR}/tclXprofile.c tclxConfig.sh
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXprofile.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXprofile.c
 
 tclXregexp.o: ${TCLX_GENERIC_DIR}/tclXregexp.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXregexp.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXregexp.c
 
 tclXselect.o: ${TCLX_GENERIC_DIR}/tclXselect.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXselect.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXselect.c
 
 tclXshell.o: ${TCLX_GENERIC_DIR}/tclXshell.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXshell.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXshell.c
 
 tclXsignal.o: ${TCLX_GENERIC_DIR}/tclXsignal.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXsignal.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXsignal.c
 
 tclXsocket.o: ${TCLX_GENERIC_DIR}/tclXsocket.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXsocket.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXsocket.c
 
 tclXstring.o: ${TCLX_GENERIC_DIR}/tclXstring.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXstring.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXstring.c
 
 tclXoscmds.o: ${TCLX_GENERIC_DIR}/tclXoscmds.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXoscmds.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXoscmds.c
 
 tclXutil.o: ${TCLX_GENERIC_DIR}/tclXutil.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXutil.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXutil.c
 
 tclXchmod.o: ${TCLX_GENERIC_DIR}/tclXchmod.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXchmod.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_GENERIC_DIR}/tclXchmod.c
 
 tclXunixDup.o: ${TCLX_UNIX_SRC_DIR}/tclXunixDup.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXunixDup.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXunixDup.c
 
 tclXid.o: ${TCLX_UNIX_SRC_DIR}/tclXid.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXid.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXid.c
 
 tclXunixCmds.o: ${TCLX_UNIX_SRC_DIR}/tclXunixCmds.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXunixCmds.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXunixCmds.c
 
 tclXunixOS.o: ${TCLX_UNIX_SRC_DIR}/tclXunixOS.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXunixOS.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXunixOS.c
 
 tclXunixId.o: ${TCLX_UNIX_SRC_DIR}/tclXunixId.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXunixId.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXunixId.c
 
 tclXunixSock.o: ${TCLX_UNIX_SRC_DIR}/tclXunixSock.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXunixSock.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXunixSock.c
 
 random.o: ${COMPAT_DIR}/random.c
-	${CC} -c ${CC_SWITCHES} ${COMPAT_DIR}/random.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${COMPAT_DIR}/random.c
 
 rename.o: ${COMPAT_DIR}/rename.c
-	${CC} -c ${CC_SWITCHES} ${COMPAT_DIR}/rename.c
+	${LIBTOOL} --mode=compile ${CC} -c ${CC_SWITCHES} ${COMPAT_DIR}/rename.c
 
 #------------------------------------------------------------------------------
 # Dependencies for generating objects (position independant versions).
