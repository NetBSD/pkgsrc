$NetBSD: patch-contrib_libbluray_P04-netbsd-pthread__equal-check.patch,v 1.1 2020/02/12 13:54:56 ryoon Exp $

* Fix segafult on recent NetBSD-current.

--- contrib/libbluray/P04-netbsd-pthread_equal-check.patch.orig	2020-02-11 08:09:40.072157575 +0000
+++ contrib/libbluray/P04-netbsd-pthread_equal-check.patch
@@ -0,0 +1,20 @@
+--- libbluray/src/util/mutex.c.orig	2019-06-07 18:00:28.000000000 +0000
++++ libbluray/src/util/mutex.c
+@@ -89,7 +89,7 @@ static int _mutex_init(MUTEX_IMPL *p)
+ 
+ static int _mutex_lock(MUTEX_IMPL *p)
+ {
+-    if (pthread_equal(p->owner, pthread_self())) {
++    if (p->owner == pthread_self()) {
+         /* recursive lock */
+         p->lock_count++;
+         return 0;
+@@ -108,7 +108,7 @@ static int _mutex_lock(MUTEX_IMPL *p)
+ 
+ static int _mutex_unlock(MUTEX_IMPL *p)
+ {
+-    if (!pthread_equal(p->owner, pthread_self())) {
++    if (!(p->owner == pthread_self())) {
+         BD_DEBUG(DBG_BLURAY|DBG_CRIT, "bd_mutex_unlock(): not owner !\n");
+         return -1;
+     }
