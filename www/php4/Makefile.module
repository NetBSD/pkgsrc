# $NetBSD: Makefile.module,v 1.6 2001/05/03 13:40:33 jlam Exp $
#
# This Makefile is provided to ease creating PHP4 packages for the extension
# modules distributed in the PHP4 sources.
#
# Just include this file, define MODNAME, define PHP_PKG_VERS if necessary,
# add dependencies, and add the appropriate --with-configure-arg, then include
# bsd.pkg.mk.
#
# PHP_PKG_VERS should be of the form "nbX" and is used to indicate revisions
# of the PHP4 module package that don't affect other PHP4 modules.  It is
# typically left empty.

.include "../../www/php4/Makefile.common"

PKGNAME=		php-${MODNAME}-${PHP_MODULE_VERS}
PHP_PKG_VERS?=		# empty
PHP_MODULE_VERS=	${PHP_BASE_VERS}${PHP_PKG_VERS}

DEPENDS+=		php-${PHP_VERS}:../../www/php4

EXTDIR=			${WRKSRC}/ext/${MODNAME}
MODULESDIR=		${WRKSRC}/modules
PLIST_SUBST+=		MODNAME=${MODNAME}

MESSAGE_SRC=		${.CURDIR}/../../www/php4/pkg/MESSAGE.module
MESSAGE_SUBST+=		MODNAME=${MODNAME}				\
			PHP_EXTENSION_DIR=${PHP_EXTENSION_DIR}

PLIST_SRC=		${.CURDIR}/../../www/php4/pkg/PLIST.module

# Ensure we export symbols in the linked ELF shared objects.
.if (${OBJECT_FMT} == "ELF")
LDFLAGS+=		-Wl,-E
.endif

do-build:
	@cd ${EXTDIR}; ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} ${ALL_TARGET}

do-install: do-module-install

do-module-install:
	${INSTALL_DATA_DIR} ${PREFIX}/${PHP_EXTENSION_DIR}
	${INSTALL_DATA} ${MODULESDIR}/${MODNAME}.so			\
		${PREFIX}/${PHP_EXTENSION_DIR}
