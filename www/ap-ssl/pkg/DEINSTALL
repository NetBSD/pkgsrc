#!/bin/sh
#
# $NetBSD: DEINSTALL,v 1.1 2001/04/29 20:36:48 jlam Exp $

PKGNAME=$1
STAGE=$2

CAT="@CAT@"
RM="@RM@"

SERVERROOT="@APACHE_SYSCONFDIR@"
SAMPLECONFDIR=${PKG_PREFIX}/share/examples/mod_ssl
CONFDIR=${SERVERROOT}
CONFFILES="apache_start.conf"
NONCONFFILES="	ssl.crl/Makefile.crl					\
		ssl.crl/README.CRL					\
		ssl.crt/Makefile.crt					\
		ssl.crt/README.CRT					\
		ssl.crt/ca-bundle.crt					\
		ssl.csr/README.CSR					\
		ssl.key/README.KEY					\
		ssl.prm/README.PRM"

case ${STAGE} in
DEINSTALL)
	# Remove configuration files if they don't differ from the default
	# config file.
	#
	for file in ${CONFFILES} ${NONCONFFILES}
	do
		FILE=${CONFDIR}/${file}
		SAMPLEFILE=${SAMPLECONFDIR}/${file}
		if diff -q ${FILE} ${SAMPLEFILE} >/dev/null
		then
			${RM} -f ${FILE}
		fi
	done
	;;

POST-DEINSTALL)
	modified_files=''
	for file in ${CONFFILES} ${NONCONFFILES}
	do
		FILE=${CONFDIR}/${file}
		if [ -f ${FILE} ]
		then
			modified_files="${modified_files} ${FILE}"
		fi
	done

	if [ -n "${modified_files}" -o -n "${existing_dirs}" ]
	then
        	${CAT} << EOF
===========================================================================
If you won't be using ${PKGNAME} any longer, you may want to remove:
EOF
		if [ -n "${modified_files}" ]
		then
			${CAT} << EOF

  * the following files:

EOF
			for file in ${modified_files}
			do
				echo "  ${file}"
			done
		fi
		${CAT} << EOF
===========================================================================
EOF
	fi
	;;

*)
	echo "Unexpected argument: ${STAGE}"
	exit 1
	;;
esac
exit 0
