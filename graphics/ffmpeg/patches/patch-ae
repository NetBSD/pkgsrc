$NetBSD: patch-ae,v 1.1 2002/03/22 11:59:19 tron Exp $

--- libavcodec/Makefile.orig    Mon Aug 13 06:52:36 2001
+++ libavcodec/Makefile
@@ -1,5 +1,4 @@
 include ../config.mak
 
-CFLAGS= $(OPTFLAGS) -Wall -g -DHAVE_AV_CONFIG_H
-LDFLAGS= -g
+CFLAGS= $(OPTFLAGS) -Wall -DHAVE_AV_CONFIG_H
 
@@ -42,23 +41,26 @@
 LIB= libavcodec.a
 TESTS= imgresample-test dct-test
 
+install: all
+	$(LIBTOOL) --mode=install $(BSD_INSTALL_DATA) $(LIB:.a=.la) $(prefix)/lib
+
 all: $(LIB)
 tests: apiexample cpuid_test $(TESTS)
 
 $(LIB): $(OBJS) $(ASM_OBJS)
 	rm -f $@
-	$(AR) rcs $@ $(OBJS) $(ASM_OBJS)
+	$(LIBTOOL) --mode=link $(CC) -o $(LIB:.a=.la) $(OBJS:.o=.lo) -rpath $(prefix)/lib
 
 dsputil.o: dsputil.c dsputil.h
 
 %.o: %.c
-	$(CC) $(CFLAGS) -c -o $@ $< 
+	$(LIBTOOL) --mode=compile $(CC) $(CFLAGS) -c -o $@ $< 
 
 %.o: %.S
-	$(CC) $(CFLAGS) -c -o $@ $<
+	$(LIBTOOL) --mode=compile $(CC) $(CFLAGS) -c -o $@ $<
 
 %.o: %.s
-	nasm -f elf -o $@ $<
+	nasm -f $(FILEFORMAT) -o $@ $<
 
 # depend only used by mplayer now
 dep:	depend
