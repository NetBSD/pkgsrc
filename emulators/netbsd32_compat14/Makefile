# $NetBSD: Makefile,v 1.14 2005/12/05 20:50:11 rillig Exp $
#

DISTNAME=		compat14-${MACHINE32_ARCH}-${VERSION}
PKGNAME=		netbsd32_compat14-${VERSION}
CATEGORIES=		emulators
MASTER_SITES=		${MASTER_SITE_LOCAL}

MAINTAINER=		tech-pkg@NetBSD.org
HOMEPAGE=		http://www.NetBSD.org/Releases/formal-1.4/index.html
COMMENT=		32-bit shared libraries for NetBSD 1.4 (and earlier) compatibility

VERSION=		1.4.3.1
PKGREVISION=		1

.if ${MACHINE_ARCH} == "sparc64"
MACHINE32_ARCH=	sparc
DEPENDS+=		netbsd32_compat15>=1.0:../../emulators/netbsd32_compat15
.elif ${MACHINE_ARCH} == "x86_64"
MACHINE32_ARCH=	i386
DEPENDS+=		netbsd32_compat16>=1.0:../../emulators/netbsd32_compat16
.else
MACHINE32_ARCH=	${MACHINE_ARCH}
.endif

ONLY_FOR_PLATFORM=	NetBSD-*-sparc64
ONLY_FOR_PLATFORM+=	NetBSD-[2-9]*-x86_64

NO_MTREE=		yes
NO_BUILD=		yes
SHLIB_HANDLING=		NO
USE_PKGINSTALL=		YES
DEINSTALL_EXTRA_TMPL+=	${.CURDIR}/DEINSTALL
INSTALL_EXTRA_TMPL+=	${.CURDIR}/INSTALL

FILES_SUBST+=		COMPAT_LIBDIR=${COMPAT_LIBDIR:Q}
FILES_SUBST+=		COMPAT_XLIBDIR=${COMPAT_XLIBDIR:Q}
FILES_SUBST+=		MACHINE_ARCH=${MACHINE_ARCH:Q}
FILES_SUBST+=		OBJECT_FMT=${OBJECT_FMT:Q}
FILES_SUBST+=		LDCONFIG=${LDCONFIG:Q}

.include "../../mk/bsd.prefs.mk"

EMULSUBDIR=		emul/aout
COMPAT_LIBDIR=		${EMULSUBDIR}/usr/lib
COMPAT_XLIBDIR=		${EMULSUBDIR}/usr/X11R6/lib

PLIST_SUBST+=		COMPAT_LIBDIR=${COMPAT_LIBDIR:Q} COMPAT_XLIBDIR=${COMPAT_XLIBDIR:Q}

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/${COMPAT_LIBDIR}
	${INSTALL_DATA} ${WRKDIR}/lib/lib*.so* ${PREFIX}/${COMPAT_LIBDIR}
	if [ -d ${WRKDIR}/X11R6/lib ]; then \
		${INSTALL_DATA_DIR} ${PREFIX}/${COMPAT_XLIBDIR}; \
		${INSTALL_DATA} ${WRKDIR}/X11R6/lib/lib*.so* ${PREFIX}/${COMPAT_XLIBDIR}; \
	fi

.include "../../mk/bsd.pkg.mk"
