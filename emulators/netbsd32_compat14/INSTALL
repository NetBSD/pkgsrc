# $NetBSD: INSTALL,v 1.3 2005/01/11 05:12:56 hamajima Exp $

case ${STAGE} in
POST-INSTALL)
	MACHINE_ARCH=@MACHINE_ARCH@
	OBJECT_FMT=@OBJECT_FMT@

	# Only create the symlink on certain platform/object combinations.  Note
	# that sparc64 a.out compatibility lives in /emul/aout, not /emul/netbsd32.
	#
	create_emul_symlink=0
	case ${MACHINE_ARCH} in
		sparc64 | x86_64)
			create_emul_symlink=1
			;;
	esac

	if [ ${create_emul_symlink} = 1 ]
	then
		# Create a symlink from /emul/aout --> ${PKG_PREFIX}/emul/aout
		# if it doesn't already exist.  Warn if we can't do this.
		#
		emul=aout
		if [ "`cd /etc && cd ${PKG_PREFIX}/emul/$emul 2>/dev/null && pwd -P`" \
		     != "`cd / && cd /emul/$emul 2>/dev/null && pwd -P`" ]
		then
			if [ -e /emul/$emul -o -L /emul/$emul ] || \
			   [ \( -e /emul -o -L /emul \) -a ! -d /emul ]
			then
				${CAT} <<EOF
==============================================================================
	IMPORTANT:  You must create a symbolic link from /emul/$emul
	to ${PKG_PREFIX}/emul/$emul in order for this package to work
	properly.

	(It seems there is something else located at /emul/$emul.)
==============================================================================
EOF
			else
				${MKDIR} -p /emul
				${LN} -sf ${PKG_PREFIX}/emul/$emul /emul/$emul
			fi
		fi
	fi

	# Regenerate the shared library cache.  This should work on either
	# a.out or on ELF with the 1.5 release.
	#
	( @LDCONFIG@ || ${TRUE} ) >/dev/null 2>&1
	;;
esac
