$NetBSD: patch-aa,v 1.7 2001/11/21 23:40:47 jlam Exp $

--- ../dist/Makefile.in.orig	Thu Nov 30 18:07:33 2000
+++ ../dist/Makefile.in
@@ -17,7 +17,7 @@
 INSTALLER=	@INSTALLER@
 
 LDFLAGS=	@LDFLAGS@
-LIBDB_ARGS=	@LIBDB_ARGS@
+LIBDB_ARGS=	$(libso_linkname)
 LIBJSO_LIBS=	@LIBJSO_LIBS@
 LIBS=		@LIBS@
 LIBSO_LIBS=	@LIBSO_LIBS@
@@ -26,19 +26,19 @@
 LIBXSO_LIBS=	@LIBXSO_LIBS@
 
 POSTLINK=	@POSTLINK@
-SOLINK=		@SOLINK@
+SOLINK=		@SOLINK@ -version-info @DB_VERSION_MINOR@:@DB_VERSION_PATCH@
 SOFLAGS=	@SOFLAGS@
 SOMAJOR=	@DB_VERSION_MAJOR@
 SOVERSION=	@DB_VERSION_MAJOR@.@DB_VERSION_MINOR@
 
-libdb=		libdb.a
+libdb=		$(libso_base).la
 
-libso_base=	libdb
-libso_linkname=	$(libso_base)-$(SOVERSION).la
-libso=		$(libso_base)-$(SOVERSION).@SOSUFFIX@
-libso_target=	$(libso_base)-$(SOVERSION).la
+libso_base=	libdb3
+libso_linkname=	$(libso_base).la
+libso=		$(libso_base).@SOSUFFIX@.$(SOVERSION)
+libso_target=	$(libso_base).la
 libso_default=	$(libso_base).@SOSUFFIX@
-libso_major=	$(libso_base)-$(SOMAJOR).@SOSUFFIX@
+libso_major=	$(libso_base).@SOSUFFIX@.$(SOMAJOR)
 
 ##################################################
 # C++
@@ -47,12 +47,12 @@
 # You must configure it using:
 #	--enable-cxx
 ##################################################
-libcxx=		libdb_cxx.a
-libxso_base=	libdb_cxx
-libxso=		$(libxso_base)-$(SOVERSION).@SOSUFFIX@
-libxso_target=	$(libxso_base)-$(SOVERSION).la
+libcxx=		libdb3_cxx.a
+libxso_base=	libdb3_cxx
+libxso=		$(libxso_base).@SOSUFFIX@.$(SOVERSION)
+libxso_target=	$(libxso_base).la
 libxso_default=	$(libxso_base).@SOSUFFIX@
-libxso_major=	$(libxso_base)-$(SOMAJOR).@SOSUFFIX@
+libxso_major=	$(libxso_base).@SOSUFFIX@.$(SOMAJOR)
 
 ##################################################
 # JAVA
@@ -72,13 +72,13 @@
 JAVA_DBDIR=	$(JAVA_SRCDIR)/$(JAVA_DBREL)
 JAVA_EXDIR=	$(JAVA_SRCDIR)/com/sleepycat/examples
 
-libj_jarfile=	db.jar
-libjso_base=	libdb_java
-libjso=		$(libjso_base)-$(SOVERSION).@SOSUFFIX@
-libjso_target=	$(libjso_base)-$(SOVERSION).la
+libj_jarfile=	db3.jar
+libjso_base=	libdb3_java
+libjso=		$(libjso_base).@SOSUFFIX@.$(SOVERSION)
+libjso_target=	$(libjso_base).la
 libjso_default=	$(libjso_base).@SOSUFFIX@
-libjso_major=	$(libjso_base)-$(SOMAJOR).@SOSUFFIX@
-libjso_g=	$(libjso_base)-$(SOVERSION)_g.@SOSUFFIX@
+libjso_major=	$(libjso_base).@SOSUFFIX@.$(SOMAJOR)
+libjso_g=	$(libjso_base)_g.@SOSUFFIX@.$(SOVERSION)
 
 ##################################################
 # TCL
@@ -88,11 +88,11 @@
 #	--enable-tcl --with-tcl=DIR --enable-dynamic
 ##################################################
 TCFLAGS=	@TCFLAGS@
-libtso_base=	libdb_tcl
-libtso=		$(libtso_base)-$(SOVERSION).@SOSUFFIX@
-libtso_target=	$(libtso_base)-$(SOVERSION).la
+libtso_base=	libdb3_tcl
+libtso=		$(libtso_base).@SOSUFFIX@.$(SOVERSION)
+libtso_target=	$(libtso_base).la
 libtso_default=	$(libtso_base).@SOSUFFIX@
-libtso_major=	$(libtso_base)-$(SOMAJOR).@SOSUFFIX@
+libtso_major=	$(libtso_base).@SOSUFFIX@.$(SOMAJOR)
 
 ##################################################
 # DB_DUMP185 UTILITY
@@ -115,7 +115,7 @@
 bindir=	@bindir@
 includedir=@includedir@
 libdir=	@libdir@
-docdir=	$(prefix)/docs
+docdir=	$(prefix)/share/doc/db3
 
 dmode=	755
 emode=	555
@@ -192,8 +192,8 @@
 	db_dump@o@ db_load@o@ db_printlog@o@ db_recover@o@ db_stat@o@ \
 	db_upgrade@o@ db_verify@o@ util_log@o@ util_sig@o@ 
 
-PROGS=  @ADDITIONAL_PROGS@ db_archive db_checkpoint db_deadlock \
-	db_dump db_load db_printlog db_recover db_stat db_upgrade db_verify
+PROGS=  @ADDITIONAL_PROGS@ db3_archive db3_checkpoint db3_deadlock \
+	db3_dump db3_load db3_printlog db3_recover db3_stat db3_upgrade db3_verify
 
 JAVA_DBSRCS=\
 	$(JAVA_DBDIR)/Db.java $(JAVA_DBDIR)/DbAppendRecno.java \
@@ -230,14 +230,6 @@
 ##################################################
 all:	@DEFAULT_LIB@ @ADDITIONAL_LIBS@ @ADDITIONAL_LANG@ $(PROGS)
 
-$(libdb): $(OBJS)
-	$(ar) $@ $(OBJS)
-	test ! -f $(ranlib) || $(ranlib) $@
-
-$(libcxx): $(COBJS) $(OBJS)
-	$(ar) $@ $(COBJS) $(OBJS)
-	test ! -f $(ranlib) || $(ranlib) $@
-
 $(libso_target): $(OBJS)
 	$(SOLINK) $(SOFLAGS) -o $(libso_target) \
 	    $(OBJS) $(LDFLAGS) $(LIBSO_LIBS)
@@ -275,57 +267,57 @@
 ##################################################
 # Utilities
 ##################################################
-berkeley_db_svc: $(RPC_SRV) util_log@o@ @DEFAULT_LIB@
+berkeley_db3_svc: $(RPC_SRV) util_log@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) $(RPC_SRV) util_log@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
 
-db_archive: db_archive@o@ util_sig@o@ @DEFAULT_LIB@
+db3_archive: db_archive@o@ util_sig@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_archive@o@ util_sig@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
 
-db_checkpoint: db_checkpoint@o@ util_log@o@ util_sig@o@ @DEFAULT_LIB@
+db3_checkpoint: db_checkpoint@o@ util_log@o@ util_sig@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_checkpoint@o@ util_log@o@ util_sig@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
 
-db_deadlock: db_deadlock@o@ util_log@o@ util_sig@o@ @DEFAULT_LIB@
+db3_deadlock: db_deadlock@o@ util_log@o@ util_sig@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_deadlock@o@ util_log@o@ util_sig@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
 
-db_dump: db_dump@o@ util_sig@o@ @DEFAULT_LIB@
+db3_dump: db_dump@o@ util_sig@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) db_dump@o@ util_sig@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
 
-db_dump185: db_dump185@o@ @LIBOBJS@
+db3_dump185: db_dump185@o@ @LIBOBJS@
 	$(CCLINK) -o $@ $(LDFLAGS) db_dump185@o@ @LIBOBJS@ $(DB185LIB)
 	$(POSTLINK) $@
 
-db_load: db_load@o@ util_sig@o@ @DEFAULT_LIB@
+db3_load: db_load@o@ util_sig@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) db_load@o@ util_sig@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
 
-db_printlog: db_printlog@o@ util_sig@o@ @DEFAULT_LIB@
+db3_printlog: db_printlog@o@ util_sig@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_printlog@o@ util_sig@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
 
-db_recover: db_recover@o@ util_sig@o@ @DEFAULT_LIB@
+db3_recover: db_recover@o@ util_sig@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_recover@o@ util_sig@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
 
-db_stat: db_stat@o@ util_sig@o@ @DEFAULT_LIB@
+db3_stat: db_stat@o@ util_sig@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) db_stat@o@ util_sig@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
 
-db_upgrade: db_upgrade@o@ util_sig@o@ @DEFAULT_LIB@
+db3_upgrade: db_upgrade@o@ util_sig@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_upgrade@o@ util_sig@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
 
-db_verify: db_verify@o@ util_sig@o@ @DEFAULT_LIB@
+db3_verify: db_verify@o@ util_sig@o@ @DEFAULT_LIB@
 	$(CCLINK) -o $@ $(LDFLAGS) \
 	    db_verify@o@ util_sig@o@ $(LIBDB_ARGS) $(LIBS)
 	$(POSTLINK) $@
@@ -409,12 +401,9 @@
 
 install_include:
 	@echo "Installing DB include files: $(includedir) ..."
-	@test -d $(includedir) || \
-	    ($(mkdir) -p $(includedir) && $(chmod) $(dmode) $(includedir))
-	@cd $(includedir) && $(rm) -f db.h db_185.h db_cxx.h
-	@$(cp) -p db.h \
+	${BSD_INSTALL_DATA_DIR} $(includedir)
+	${BSD_INSTALL_DATA} db.h \
 	    $(srcdir)/include/db_cxx.h @ADDITIONAL_INCS@ $(includedir)
-	@cd $(includedir) && $(chmod) $(fmode) db.h db_cxx.h @ADDITIONAL_INCS@
 
 uninstall_include:
 	-cd $(includedir) && $(rm) -f db.h db_185.h db_cxx.h
@@ -452,8 +441,6 @@
 	@cd $(libdir) && $(rm) -f \
 	    $(libso_target) $(libso) $(libso_default) $(libso_major)
 	@$(INSTALLER) $(libso_target) $(libdir)
-	@cd $(libdir) && $(ln) -s $(libso) $(libso_default)
-	@cd $(libdir) && $(ln) -s $(libso) $(libso_major)
 	@$(LIBTOOL) --mode=finish $(libdir)
 
 install_dynamic_cxx:
@@ -463,8 +450,6 @@
 	@cd $(libdir) && $(rm) -f \
 	    $(libxso_target) $(libxso) $(libxso_default) $(libxso_major)
 	@$(INSTALLER) $(libxso_target) $(libdir)
-	@cd $(libdir) && $(ln) -s $(libxso) $(libxso_default)
-	@cd $(libdir) && $(ln) -s $(libxso) $(libxso_major)
 
 install_tcl:
 	@echo "Installing DB Tcl library: $(libdir) ..."
@@ -473,8 +458,6 @@
 	@cd $(libdir) && $(rm) -f \
 	    $(libtso_target) $(libtso) $(libtso_default) $(libtso_major)
 	@$(INSTALLER) $(libtso_target) $(libdir)
-	@cd $(libdir) && $(ln) -s $(libtso) $(libtso_default)
-	@cd $(libdir) && $(ln) -s $(libtso) $(libtso_major)
 
 install_java:
 	@echo "Installing DB Java library: $(libdir) ..."
@@ -483,27 +466,21 @@
 	@cd $(libdir) && $(rm) -f \
 	    $(libjso_target) $(libjso) $(libjso_default) $(libjso_major)
 	@$(INSTALLER) $(libjso_target) $(libdir)
-	@cd $(libdir) && $(ln) -s $(libjso) $(libjso_default)
-	@cd $(libdir) && $(ln) -s $(libjso) $(libjso_major)
-	@cd $(libdir) && $(ln) -s $(libjso) $(libjso_g)
 	@$(cp) $(JAVA_CLASSTOP)/$(libj_jarfile) $(libdir)
 
 install_utilities:
 	@echo "Installing DB utilities: $(bindir) ..."
-	@test -d $(bindir) || \
-	    ($(mkdir) -p $(bindir) && $(chmod) $(dmode) $(bindir))
-	@cd $(bindir) && $(rm) -f $(PROGS)
-	@$(INSTALLER) -fp $(PROGS) $(bindir)
-	@cd $(bindir) && (test ! -f $(strip) || $(strip) $(PROGS))
-	@cd $(bindir) && $(chmod) $(emode) $(PROGS)
+	${BSD_INSTALL_PROGRAM_DIR} $(bindir)
+	for i in $(PROGS); do \
+		$(LIBTOOL) ${BSD_INSTALL_PROGRAM} $$i $(bindir); \
+	done
 
 uninstall_utilities:
 	-cd $(bindir) && $(rm) -f $(PROGS)
 
 install_docs:
 	@echo "Installing documentation: $(docdir) ..."
-	@test -d $(docdir) || \
-	    ($(mkdir) -p $(docdir) && $(chmod) $(dmode) $(docdir))
+	${BSD_INSTALL_DATA_DIR} $(docdir)
 	@cd $(docdir) && $(rm) -rf *
 	@cd $(srcdir)/docs && $(cp) -pr * $(docdir)/
 
