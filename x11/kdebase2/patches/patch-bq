$NetBSD: patch-bq,v 1.2 2001/10/18 08:17:49 skrll Exp $

--- kicker/Makefile.in.orig	Sat Sep  8 01:36:32 2001
+++ kicker/Makefile.in
@@ -19,10 +18,6 @@
 VPATH = @srcdir@
 prefix = @prefix@
 exec_prefix = @exec_prefix@
-#>- 
-bindir = @bindir@
-#>+ 3
-DEPDIR = .deps
 
 bindir = @bindir@
 sbindir = @sbindir@
@@ -276,7 +271,7 @@
 SUBDIRS = share core ui . proxy taskmanager taskbar applets extensions data
 
 bin_PROGRAMS = kicker
-lib_LTLIBRARIES = kicker.la
+lib_LTLIBRARIES = kicker.la libkicker.la
 
 CLEANFILES = dummy.cpp
 
@@ -284,7 +279,11 @@
 kicker_la_SOURCES = dummy.cpp
 kicker_la_LDFLAGS = $(KDE_PLUGIN) -no-undefined -module
 
-kicker_LDADD = kicker.la
+libkicker_la_LIBADD = share/libkicker_share.la core/libkicker_core.la  ui/libkicker_ui.la $(LIB_KSYCOCA) $(LIB_KFILE)
+libkicker_la_SOURCES = dummy.cpp
+libkicker_la_LDFLAGS = $(KDE_PLUGIN)
+
+kicker_LDADD = libkicker.la
 kicker_SOURCES = dummy.cpp
 kicker_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
@@ -304,54 +303,37 @@
 X_LIBS = @X_LIBS@
 kicker_la_DEPENDENCIES =  share/libkicker_share.la \
 core/libkicker_core.la ui/libkicker_ui.la
-#>- kicker_la_OBJECTS =  dummy.lo
-#>+ 1
-kicker_la_OBJECTS = dummy.lo
+kicker_la_OBJECTS =  dummy.lo
+libkicker_la_DEPENDENCIES =  share/libkicker_share.la \
+core/libkicker_core.la ui/libkicker_ui.la
+libkicker_la_OBJECTS =  dummy.lo
 bin_PROGRAMS =  kicker$(EXEEXT)
 PROGRAMS =  $(bin_PROGRAMS)
 
-#>- kicker_OBJECTS =  dummy.$(OBJEXT)
-#>+ 1
-kicker_OBJECTS = dummy.$(OBJEXT)
-kicker_DEPENDENCIES =  kicker.la
+kicker_OBJECTS =  dummy.$(OBJEXT)
+kicker_DEPENDENCIES =  libkicker.la
 CXXFLAGS = @CXXFLAGS@
-#>- CXXCOMPILE = $(CXX) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
-#>+ 1
-CXXCOMPILE = $(CXX) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) $(KDE_CXXFLAGS)
-#>- LTCXXCOMPILE = $(LIBTOOL) --mode=compile $(CXX) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
-#>+ 1
-LTCXXCOMPILE = $(LIBTOOL) --mode=compile --tag=CXX $(CXX) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) $(KDE_CXXFLAGS)
+CXXCOMPILE = $(CXX) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
+LTCXXCOMPILE = $(LIBTOOL) --mode=compile $(CXX) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 CXXLD = $(CXX)
-#>- CXXLINK = $(LIBTOOL) --mode=link $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(LDFLAGS) -o $@
-#>+ 1
-CXXLINK = $(LIBTOOL) --mode=link --tag=CXX $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(KDE_CXXFLAGS) $(LDFLAGS) -o $@
+CXXLINK = $(LIBTOOL) --mode=link $(CXXLD) $(AM_CXXFLAGS) $(CXXFLAGS) $(LDFLAGS) -o $@
 DATA =  $(autostart_DATA)
 
 DIST_COMMON =  AUTHORS Makefile.am Makefile.in TODO
 
 
-#>- DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-#>+ 4
-KDE_DIST=panel.desktop 
-
-DISTFILES= $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST) $(KDE_DIST)
-
+DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
 
 TAR = tar
 GZIP_ENV = --best
-SOURCES = $(kicker_la_SOURCES) $(kicker_SOURCES)
-OBJECTS = $(kicker_la_OBJECTS) $(kicker_OBJECTS)
+SOURCES = $(kicker_la_SOURCES) $(libkicker_la_SOURCES) $(kicker_SOURCES)
+OBJECTS = $(kicker_la_OBJECTS) $(libkicker_la_OBJECTS) $(kicker_OBJECTS)
 
-#>- all: all-redirect
-#>+ 1
-all: docs-am  all-redirect
+all: all-redirect
 .SUFFIXES:
 .SUFFIXES: .S .c .cpp .lo .o .obj .s
 $(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-#>- 	cd $(top_srcdir) && $(AUTOMAKE) --foreign --include-deps kicker/Makefile
-#>+ 2
 	cd $(top_srcdir) && $(AUTOMAKE) --foreign --include-deps kicker/Makefile
-	cd $(top_srcdir) && perl admin/am_edit kicker/Makefile.in
 
 Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
 	cd $(top_builddir) \
@@ -427,12 +409,12 @@
 
 maintainer-clean-libtool:
 
-#>- kicker.la: $(kicker_la_OBJECTS) $(kicker_la_DEPENDENCIES)
-#>+ 2
-@KDE_USE_CLOSURE_TRUE@kicker.la: kicker.la.closure $(kicker_la_OBJECTS) $(kicker_la_DEPENDENCIES)
-@KDE_USE_CLOSURE_FALSE@kicker.la: $(kicker_la_OBJECTS) $(kicker_la_DEPENDENCIES)
+kicker.la: $(kicker_la_OBJECTS) $(kicker_la_DEPENDENCIES)
 	$(CXXLINK) -rpath $(libdir) $(kicker_la_LDFLAGS) $(kicker_la_OBJECTS) $(kicker_la_LIBADD) $(LIBS)
 
+libkicker.la: $(libkicker_la_OBJECTS) $(libkicker_la_DEPENDENCIES)
+	$(CXXLINK) -rpath $(libdir) $(libkicker_la_LDFLAGS) $(libkicker_la_OBJECTS) $(libkicker_la_LIBADD) $(LIBS)
+
 mostlyclean-binPROGRAMS:
 
 clean-binPROGRAMS:
@@ -523,7 +505,7 @@
 	dot_seen=no; \
 	rev=''; list='$(SUBDIRS)'; for subdir in $$list; do \
 	  rev="$$subdir $$rev"; \
-	  test "$$subdir" = "." && dot_seen=yes; \
+	  test "$$subdir" != "." || dot_seen=yes; \
 	done; \
 	test "$$dot_seen" = "no" && rev=". $$rev"; \
 	target=`echo $@ | sed s/-recursive//`; \
@@ -581,17 +563,6 @@
 subdir = kicker
 
 distdir: $(DISTFILES)
-#>- 	@for file in $(DISTFILES); do \
-#>- 	  d=$(srcdir); \
-#>- 	  if test -d $$d/$$file; then \
-#>- 	    cp -pr $$/$$file $(distdir)/$$file; \
-#>- 	  else \
-#>- 	    test -f $(distdir)/$$file \
-#>- 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-#>- 	    || cp -p $$d/$$file $(distdir)/$$file || :; \
-#>- 	  fi; \
-#>- 	done
-#>+ 10
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
@@ -658,17 +629,11 @@
 
 mostlyclean: mostlyclean-recursive
 
-#>- clean-am:  clean-libLTLIBRARIES clean-compile clean-libtool \
-#>- 		clean-binPROGRAMS clean-tags clean-generic \
-#>- 		mostlyclean-am
-#>+ 3
-clean-am: clean-closures clean-final   clean-libLTLIBRARIES clean-compile clean-libtool \
+clean-am:  clean-libLTLIBRARIES clean-compile clean-libtool \
 		clean-binPROGRAMS clean-tags clean-generic \
 		mostlyclean-am
 
-#>- clean: clean-recursive
-#>+ 1
-clean: kde-rpo-clean  clean-recursive
+clean: clean-recursive
 
 distclean-am:  distclean-libLTLIBRARIES distclean-compile \
 		distclean-libtool distclean-binPROGRAMS distclean-tags \
@@ -716,67 +681,3 @@
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
 .NOEXPORT:
-
-#>+ 8
-kicker.la.closure: $(kicker_la_OBJECTS) $(kicker_la_DEPENDENCIES)
-	@echo "int main() {return 0;}" > kicker_la_closure.cpp
-	@$(LTCXXCOMPILE) -c kicker_la_closure.cpp
-	@$(CXXLINK) kicker_la_closure.lo $(kicker_la_LDFLAGS) $(kicker_la_OBJECTS) $(kicker_la_LIBADD) $(LIBS)
-	@rm -f kicker_la_closure.* kicker.la.closure
-	@echo "timestamp" > kicker.la.closure
-
-
-#>+ 3
-clean-closures:
-	-rm -f  kicker.la.closure
-
-#>+ 2
-docs-am:
-
-#>+ 5
-force-reedit:
-		cd $(top_srcdir) && $(AUTOMAKE) --foreign --include-deps kicker/Makefile
-	cd $(top_srcdir) && perl admin/am_edit kicker/Makefile.in
-
-
-#>+ 11
-kicker_la.all_cpp.cpp: $(srcdir)/Makefile.in dummy.cpp  
-	@echo 'creating kicker_la.all_cpp.cpp ...'; \
-	rm -f kicker_la.all_cpp.files kicker_la.all_cpp.final; \
-	echo "#define KDE_USE_FINAL 1" >> kicker_la.all_cpp.final; \
-	for file in dummy.cpp ; do \
-	  echo "#include \"$$file\"" >> kicker_la.all_cpp.files; \
-	  test ! -f $(srcdir)/$$file || egrep '^#pragma +implementation' $(srcdir)/$$file >> kicker_la.all_cpp.final; \
-	done; \
-	cat kicker_la.all_cpp.final kicker_la.all_cpp.files  > kicker_la.all_cpp.cpp; \
-	rm -f kicker_la.all_cpp.final kicker_la.all_cpp.files
-
-#>+ 11
-kicker.all_cpp.cpp: $(srcdir)/Makefile.in dummy.cpp  
-	@echo 'creating kicker.all_cpp.cpp ...'; \
-	rm -f kicker.all_cpp.files kicker.all_cpp.final; \
-	echo "#define KDE_USE_FINAL 1" >> kicker.all_cpp.final; \
-	for file in dummy.cpp ; do \
-	  echo "#include \"$$file\"" >> kicker.all_cpp.files; \
-	  test ! -f $(srcdir)/$$file || egrep '^#pragma +implementation' $(srcdir)/$$file >> kicker.all_cpp.final; \
-	done; \
-	cat kicker.all_cpp.final kicker.all_cpp.files  > kicker.all_cpp.cpp; \
-	rm -f kicker.all_cpp.final kicker.all_cpp.files
-
-#>+ 3
-clean-final:
-	-rm -f kicker_la.all_cpp.cpp kicker.all_cpp.cpp
-
-#>+ 2
-final:
-	$(MAKE) all-am
-#>+ 2
-no-final:
-	$(MAKE) all-am
-#>+ 3
-cvs-clean:
-	$(MAKE) -f $(top_srcdir)/admin/Makefile.common cvs-clean
-
-#>+ 3
-kde-rpo-clean:
-	-rm -f *.rpo
