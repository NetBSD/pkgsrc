$NetBSD: patch-ac,v 1.4 2005/09/13 22:51:42 reed Exp $

--- config/cf/NetBSD.cf.in.orig	2004-08-14 17:03:36.000000000 -0700
+++ config/cf/NetBSD.cf.in	2005-09-12 15:21:11.000000000 -0700
@@ -123,7 +123,7 @@
 # define ThreadedX		YES
 # define HasThreadSafeAPI	YES
 # define ThreadsLibraries	-lpthread
-# define LibraryMTDefines	-DUSE_NBSD_THREADLIB
+# define LibraryMTDefines	@@NETBSD_THREADLIB@@
 # define SystemMTDefines	-D_REENTRANT
 # define MTSafeAPIDefines	-DXUSE_MTSAFE_API -DXNO_MTSAFE_PWDAPI
 #else 
@@ -146,7 +146,7 @@
 #define MkdirHierCmd		mkdir -p
 
 #undef CcCmd
-#define CcCmd 			gcc
+#define CcCmd 			@@PKGSRC_CC@@
 #ifndef DefaultCCOptions
 #if defined(UseInstalled)
 #define DefaultCCOptions 	/**/
@@ -162,7 +162,7 @@
 #endif
 #endif
 
-#define CppCmd			cpp
+#define CppCmd			@@PKGSRC_CPP@@
 #define StandardCppOptions	-traditional
 #define StandardCppDefines	/**/
 #define PreProcessCmd   	CcCmd -E
@@ -191,7 +191,7 @@
  * Disabled for NetBSD/vax until I figure out the scheme. --CS 
  */
 #if ((OSMajorVersion > 0) && defined(i386Architecture)) || \
-    defined(PpcArchitecture)
+    defined(PpcArchitecture) || defined(AMD64Architecture)
 #  ifndef DoLoadableServer
 #  define DoLoadableServer	YES
 #  endif
@@ -211,13 +211,7 @@
 #define HasWeakSymbols		UseElfFormat 
 
 #ifdef i386Architecture
-# ifndef DefaultGcc2i386Opt
-#  if OSMajorVersion > 1 || (OSMajorVersion == 1 && OSMinorVersion > 2)
-    /* The GCC strength-reduce bug is fixed for NetBSD 1.3 and later */
-#   define DefaultGcc2i386Opt -O2 GccAliasingArgs
-#  endif
-# endif
-# define OptimizedCDebugFlags 	DefaultGcc2i386Opt
+# define OptimizedCDebugFlags 	@@PKGSRC_CFLAGS@@
 # if OSMajorVersion < 1
 #  define ServerOSDefines	XFree86ServerOSDefines -DXNO_SYSCONF
 # else
@@ -227,7 +221,7 @@
 #  define ServerExtraSysLibs	-li386
 # endif
 #else
-# define OptimizedCDebugFlags 	-O2
+# define OptimizedCDebugFlags 	@@PKGSRC_CFLAGS@@
 # if defined(SparcArchitecture)
 #  define ServerOSDefines 	-DDDXOSINIT
 # elif defined(AlphaArchitecture)
@@ -236,11 +230,17 @@
 #   define ServerOSDefines	XFree86ServerOSDefines -DDDXTIME
 # elif defined(PpcArchitecture)
 #  define ServerOSDefines	XFree86ServerOSDefines -DDDXTIME -DDDXOSINIT
+# elif defined(AMD64Architecture)
+#  undef OptimizedCDebugFlags
+#  define OptimizedCDebugFlags -O2
+#  define ServerOSDefines 	XFree86ServerOSDefines
 # else
 #  define ServerOSDefines 	/**/
 # endif
 # if defined(AlphaArchitecture)
 #  define ServerExtraSysLibs	-lalpha
+# elif defined(AMD64Architecture)
+#  define ServerExtraSysLibs   -lx86_64
 # else
 #  define ServerExtraSysLibs	/**/
 # endif
@@ -280,6 +280,11 @@
 #  ifndef XFree86ConsoleDefines
 #    define XFree86ConsoleDefines	-DWSCONS_SUPPORT
 #  endif
+#elif defined(AMD64Architecture)
+# define ServerExtraDefines    GccGasOption XFree86ServerDefines -D_XSERVER64
+#  ifndef XFree86ConsoleDefines
+#    define XFree86ConsoleDefines -DWSCONS_SUPPORT -DPCVT_SUPPORT
+#  endif
 #else
 #  define ServerExtraDefines GccGasOption
 #endif
@@ -400,6 +405,10 @@
 # endif /* MTRRBuiltin */
 #endif /* i386Architecture */
 
+#if defined(AMD64Architecture)
+# define HasMTRRBuiltin		YES
+#endif
+
 /*
  * agpgart support (NetBSD 1.5Y and up)
  */
@@ -468,9 +477,7 @@
 file.0:: file.$(MANNEWSUFFIX)						@@\
 	@if [ -f file.$(MANNEWSUFFIX) ]; \				@@\
 	then \								@@\
-	cat file.$(MANNEWSUFFIX) | $(NEQN) | $(TBL) | $(NROFF) $(MANMACROS) | $(COL) >/tmp/$$$$.man; \	@@\
-	cp /tmp/$$$$.man file.0; \					@@\
-	$(RM) /tmp/$$$$.man; \						@@\
+	cat file.$(MANNEWSUFFIX) | $(NEQN) | $(TBL) | $(NROFF) $(MANMACROS) | $(COL) > file.0; \	@@\
 	fi 								@@\
 									@@\
 install.man::                                                           @@\
@@ -588,7 +595,7 @@
 # define BuildXInputLib          YES
 #endif
 
-#if defined(i386Architecture) || defined(Arm32Architecture) || defined(AlphaArchitecture) || defined(PpcArchitecture)
+#if defined(i386Architecture) || defined(Arm32Architecture) || defined(AlphaArchitecture) || defined(PpcArchitecture) || defined(AMD64Architecture)
 # include <xorg.cf>
 #endif
 
