A simple (but internally ugly) memoization function.
