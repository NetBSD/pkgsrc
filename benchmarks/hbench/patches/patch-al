$NetBSD: patch-al,v 1.2 2001/09/22 20:47:15 jdolecek Exp $

--- src/bw_pipe.c.orig	Fri Sep 21 18:39:15 2001
+++ src/bw_pipe.c	Fri Sep 21 18:39:48 2001
@@ -147,6 +147,8 @@ do_pipexfer(num_iter, t)
 	/* Spawn off a writer, then time the read */
 	switch (fork()) {
 	case 0:			/* writer */
+		close(pipes[0]);
+
 		while ((done < todo) &&
 		       ((n = write(pipes[1], buf, bufsize)) > 0))
 			done += n;
@@ -159,6 +161,8 @@ do_pipexfer(num_iter, t)
 		/*NOTREACHED*/
 		
 	default:		/* reader */
+		close(pipes[1]);
+
 		/* wait for writer */
 		sleep(1);
 		
@@ -168,6 +172,7 @@ do_pipexfer(num_iter, t)
 			done += n;
 		*t = stop();	/* stop timing */
 
+		close(pipes[0]);
 		wait(&termstat); /* wait for writer to exit */
 	}
 	
